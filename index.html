<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rituva â€“ Weather & AQI Intelligence</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<style>
*{box-sizing:border-box;font-family:system-ui}
body{
margin:0;min-height:100vh;display:flex;justify-content:center;
padding:12px;background:linear-gradient(135deg,#667eea,#764ba2)
}
.app{
width:100%;max-width:390px;padding:16px;border-radius:22px;
background:rgba(255,255,255,.18);backdrop-filter:blur(16px)
}
input,button{
width:100%;padding:12px;border-radius:12px;border:none;margin-bottom:10px
}
button{font-weight:bold;background:rgba(255,255,255,.35)}
.details{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.card{
background:rgba(255,255,255,.25);
border-radius:14px;padding:10px;text-align:center;font-size:13px
}
.big{font-size:26px;font-weight:bold}
#temp{font-size:52px;font-weight:800;text-align:center}

.hourly{display:flex;gap:8px;overflow-x:auto;padding-bottom:4px}
.hour{display:flex;flex-direction:column;align-items:center;font-size:10px}
.bar{width:18px;border-radius:6px 6px 0 0}
.bar.temp{background:#ff7043}
.bar.aqi{background:#43a047}
.bar.rain{background:#42a5f5}

/* DARK + OLED */
body.dark{background:#121212}
body.oled{background:#000}
body.dark .app,body.oled .app{background:#000}
body.dark *,body.oled *{color:#fff}
body.dark input,body.dark button,
body.oled input,body.oled button{background:#1f1f1f;color:#fff}
</style>
</head>

<body>
<div class="app">

<h1>ğŸŒ¦ Rituva</h1>
<button id="themeBtn">ğŸŒ™ Dark Mode</button>

<input id="cityInput" placeholder="Search city">
<button onclick="searchCity()">Search</button>
<button onclick="useLocation()">ğŸ“ Use My Location</button>

<h2 id="location">Loadingâ€¦</h2>
<div id="temp">--Â°C</div>

<div class="details">
  <div class="card"><h4>AQI</h4><div id="aqiValue" class="big">--</div><div id="aqiLabel">--</div></div>
  <div class="card"><h4>Wind</h4><div id="wind">--</div></div>
  <div class="card"><h4>Rain</h4><div id="rainNow">-- mm</div></div>
  <div class="card"><h4>Humidity</h4><div id="humidity">-- %</div></div>
  <div class="card"><h4>Dew Point</h4><div id="dew">-- Â°C</div></div>
</div>

<h3>ğŸŒ« AQI Insights</h3>
<div class="details" id="aqiInsights"></div>

<h3>â˜” Rain Intelligence</h3>
<div class="details" id="rainIntel"></div>

<h3>ğŸ“ˆ AQI (24H)</h3>
<div class="hourly" id="aqiGraph"></div>

<h3>ğŸŒ¡ Temperature (24H)</h3>
<div class="hourly" id="tempGraph"></div>

<h3>ğŸŒ§ Precipitation (24H)</h3>
<div class="hourly" id="rainGraph"></div>

<h3>ğŸ“… 7-Day Temperature (Min / Max)</h3>
<div class="details" id="temp7d"></div>

<h3>ğŸŒ§ 7-Day Rain Forecast</h3>
<div class="details" id="rain7d"></div>

<h3>ğŸŒ« 7-Day AQI Forecast</h3>
<div class="details" id="aqi7d"></div>

<h3>ğŸ”¥â„ Weekly Extreme Alert</h3>
<div class="details" id="extremeAlert"></div>

<footer style="text-align:center;font-size:11px;margin-top:12px">
Â© Manik Roy 2026. All Rights Reserved.
</footer>

</div>

<script>
const $=i=>document.getElementById(i);
const avg=a=>a.reduce((x,y)=>x+y,0)/a.length;
const last24=a=>a.slice(-24);
const compass=d=>["N","NE","E","SE","S","SW","W","NW"][Math.round(d/45)%8];

/* AQI CPCB */
const calc=(c,b)=>Math.round(((b[3]-b[2])/(b[1]-b[0]))*(c-b[0])+b[2]);
const PM25=c=>{let b=[[0,30,0,50],[31,60,51,100],[61,90,101,200],[91,120,201,300],[121,250,301,400],[251,500,401,500]];for(let i of b)if(c<=i[1])return calc(c,i)};
const PM10=c=>{let b=[[0,50,0,50],[51,100,51,100],[101,250,101,200],[251,350,201,300],[351,430,301,400],[431,600,401,500]];for(let i of b)if(c<=i[1])return calc(c,i)};

function bars(el,data,max,cls){
el.innerHTML="";
data.forEach(v=>el.innerHTML+=`<div class="hour"><div class="bar ${cls}" style="height:${Math.max(4,(v/max)*120)}px"></div></div>`);
}

let theme="light";
themeBtn.onclick=()=>{theme=theme==="light"?"dark":theme==="dark"?"oled":"light";document.body.className=theme==="light"?"":theme};

async function load(lat,lon,name){
$("location").textContent = name;   // âœ… FIXED HERE

const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,precipitation,precipitation_probability,relative_humidity_2m,dew_point_2m,cape&daily=temperature_2m_min,temperature_2m_max,precipitation_sum&timezone=auto`).then(r=>r.json());

const a=await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5,pm10&timezone=auto`).then(r=>r.json());

$("temp").textContent=w.current_weather.temperature+"Â°C";
$("wind").textContent=w.current_weather.windspeed+" km/h "+compass(w.current_weather.winddirection);
$("humidity").textContent=w.hourly.relative_humidity_2m.at(-1)+" %";
$("dew").textContent=w.hourly.dew_point_2m.at(-1)+" Â°C";
$("rainNow").textContent=w.hourly.precipitation.at(-1)+" mm";

/* AQI */
let pm25=last24(a.hourly.pm2_5), pm10=last24(a.hourly.pm10);
let aqi24=pm25.map((v,i)=>Math.max(PM25(v),PM10(pm10[i])));
let aqi=Math.round(avg(aqi24));
$("aqiValue").textContent=aqi;
$("aqiLabel").textContent=aqi<=50?"Good":aqi<=100?"Satisfactory":aqi<=200?"Moderate":aqi<=300?"Poor":"Severe";

/* AQI INSIGHTS */
$("aqiInsights").innerHTML=`
<div class="card">Category<br><b>${$("aqiLabel").textContent}</b></div>
<div class="card">AQI Value<br><b>${aqi}</b></div>
<div class="card">Dominant Pollutant<br><b>${PM25(avg(pm25))>PM10(avg(pm10))?"PM2.5":"PM10"}</b></div>
<div class="card">24H Trend<br><b>${aqi24.at(-1)>aqi24[0]?"Rising â†‘":"Falling â†“"}</b></div>
<div class="card">Health Risk<br><b>${aqi>200?"High":"Moderate"}</b></div>
<div class="card">Mask Advice<br><b>${aqi<=100?"Optional":"N95 Recommended"}</b></div>`;

/* RAIN INTELLIGENCE */
let prob=last24(w.hourly.precipitation_probability);
let cape=last24(w.hourly.cape);
let rain3=w.hourly.precipitation.slice(-3).reduce((a,b)=>a+b,0);
$("rainIntel").innerHTML=`
<div class="card">Rain Probability<br><b>${Math.max(...prob)}%</b></div>
<div class="card">Rain Alert (3H)<br><b>${rain3>10?"Heavy":rain3>3?"Moderate":rain3>0?"Light":"None"}</b></div>
<div class="card">Thunderstorm Risk<br><b>${Math.max(...cape)>2000?"Severe":Math.max(...cape)>1000?"Possible":"Low"}</b></div>
<div class="card">Humidity Avg<br><b>${Math.round(avg(w.hourly.relative_humidity_2m))}%</b></div>`;

/* GRAPHS */
bars(aqiGraph,aqi24,300,"aqi");
bars(tempGraph,last24(w.hourly.temperature_2m),45,"temp");
bars(rainGraph,last24(w.hourly.precipitation),10,"rain");

/* 7-DAY + ALERTS */
temp7d.innerHTML="";
w.daily.temperature_2m_min.forEach((m,i)=>temp7d.innerHTML+=`<div class="card">Day ${i+1}<br><b>${m}Â°C / ${w.daily.temperature_2m_max[i]}Â°C</b></div>`);

rain7d.innerHTML="";
w.daily.precipitation_sum.forEach((r,i)=>rain7d.innerHTML+=`<div class="card">Day ${i+1}<br><b>${r} mm</b></div>`);

aqi7d.innerHTML="";
for(let d=0;d<7;d++){
let s25=a.hourly.pm2_5.slice(d*24,(d+1)*24);
let s10=a.hourly.pm10.slice(d*24,(d+1)*24);
let v=Math.round(avg(s25.map((x,i)=>Math.max(PM25(x),PM10(s10[i])))));
aqi7d.innerHTML+=`<div class="card">Day ${d+1}<br><b>${v}</b></div>`;
}

let max=Math.max(...w.daily.temperature_2m_max);
let min=Math.min(...w.daily.temperature_2m_min);
extremeAlert.innerHTML=`
<div class="card">Max<br><b>${max}Â°C</b></div>
<div class="card">Min<br><b>${min}Â°C</b></div>
<div class="card"><b>${max>=40?"ğŸ”¥ Heatwave":min<=10?"â„ Coldwave":"Normal"}</b></div>`;
}

async function searchCity(){
let q=$("cityInput").value;if(!q)return;
let g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1`).then(r=>r.json());
load(g.results[0].latitude,g.results[0].longitude,g.results[0].name);
}
function useLocation(){
navigator.geolocation.getCurrentPosition(p=>load(p.coords.latitude,p.coords.longitude,"Current Location"));
}

load(22.5726,88.3639,"Kolkata, India");
if("serviceWorker"in navigator){navigator.serviceWorker.register("sw.js")}
</script>
</body>
</html>

