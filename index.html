<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Rituva</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000">

<style>
*{box-sizing:border-box;font-family:system-ui,-apple-system}
body{
margin:0;
background:#000;
color:#fff;
display:flex;
justify-content:center;
}
.app{
width:100%;
max-width:420px;
padding:18px 16px 40px;
}

/* HEADER */
.header{
display:flex;
align-items:center;
gap:10px;
font-size:32px;
font-weight:700;
margin-bottom:18px;
}

/* BUTTONS */
.btn,input{
width:100%;
padding:18px;
border-radius:22px;
border:none;
background:#1e1e1e;
color:#fff;
font-size:18px;
margin-bottom:14px;
}
.btn.secondary{background:#262626}

/* LOCATION */
.location{
font-size:28px;
font-weight:600;
margin:22px 0 6px;
}

/* TEMP */
.temp{
font-size:88px;
font-weight:800;
text-align:center;
margin:12px 0 28px;
}

/* GRID */
.grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:16px;
}
.card{
background:#5a5a5a;
border-radius:22px;
padding:18px;
text-align:center;
}
.card h4{
margin:0;
font-weight:500;
opacity:.9;
}
.card .value{
font-size:34px;
font-weight:700;
margin-top:8px;
}
.card small{
font-size:16px;
opacity:.9;
}

/* SECTION */
.section{
margin-top:30px;
}
.section h3{
margin-bottom:12px;
font-size:22px;
}

/* BARS */
.bars{
display:flex;
gap:8px;
overflow-x:auto;
padding-bottom:8px;
}
.barwrap{
display:flex;
flex-direction:column;
align-items:center;
font-size:11px;
}
.bar{
width:18px;
border-radius:8px 8px 0 0;
}
.bar.temp{background:#ff7043}
.bar.aqi{background:#43a047}
.bar.rain{background:#42a5f5}
</style>
</head>

<body>
<div class="app">

<div class="header">üå¶Ô∏è Rituva</div>

<button class="btn secondary">üñ§ OLED Mode</button>

<input id="search" placeholder="Search city / mountain / sea">
<button class="btn" onclick="searchCity()">Search</button>
<button class="btn secondary" onclick="useLocation()">üìç Use My Location</button>

<div class="location" id="place">‚Äî</div>
<div class="temp" id="temp">--¬∞C</div>

<div class="grid">
  <div class="card">
    <h4>AQI</h4>
    <div class="value" id="aqi">--</div>
    <small id="aqiLabel">‚Äî</small>
  </div>
  <div class="card">
    <h4>Wind</h4>
    <div class="value" id="wind">--</div>
    <small>km/h</small>
  </div>
  <div class="card">
    <h4>Pressure</h4>
    <div class="value" id="pressure">--</div>
    <small>hPa</small>
  </div>
  <div class="card">
    <h4>Elevation</h4>
    <div class="value" id="elevation">--</div>
    <small>m</small>
  </div>
</div>

<!-- RAIN -->
<div class="section">
<h3>‚òî Rain Intelligence</h3>
<div class="grid">
<div class="card"><h4>Now</h4><div class="value" id="rainNow">--</div><small>mm</small></div>
<div class="card"><h4>Next 3h</h4><div class="value" id="rain3h">--</div><small>mm</small></div>
</div>
</div>

<!-- AQI GRAPH -->
<div class="section">
<h3>üìà AQI (24H)</h3>
<div class="bars" id="aqiGraph"></div>
</div>

<!-- TEMP GRAPH -->
<div class="section">
<h3>üå° Temperature (24H)</h3>
<div class="bars" id="tempGraph"></div>
</div>

<!-- 7 DAY -->
<div class="section">
<h3>üìÖ 7-Day Temperature</h3>
<div class="grid" id="temp7d"></div>
</div>

</div>

<script>
const $=id=>document.getElementById(id);
const avg=a=>a.reduce((x,y)=>x+y,0)/a.length;

function bar(el,val,max,cls,label){
let h=Math.max(4,(val/max)*120);
return `<div class="barwrap">
<div class="bar ${cls}" style="height:${h}px"></div>
<small>${label}</small>
</div>`;
}

/* AQI CPCB */
function calc(c,b){return Math.round(((b[3]-b[2])/(b[1]-b[0]))*(c-b[0])+b[2])}
function PM25(c){
let b=[[0,30,0,50],[31,60,51,100],[61,90,101,200],[91,120,201,300],[121,250,301,400],[251,500,401,500]];
for(let i of b) if(c<=i[1]) return calc(c,i);
}
function labelAQI(a){
return a<=50?"Good":a<=100?"Satisfactory":a<=200?"Moderate":a<=300?"Poor":"Severe";
}

async function load(lat,lon,name){
$("place").textContent=name;

const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,precipitation,surface_pressure&daily=temperature_2m_max,temperature_2m_min&timezone=auto`).then(r=>r.json());
const a=await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5&timezone=auto`).then(r=>r.json());
const e=await fetch(`https://api.open-meteo.com/v1/elevation?latitude=${lat}&longitude=${lon}`).then(r=>r.json());

$("temp").textContent=Math.round(w.current_weather.temperature)+"¬∞C";
$("wind").textContent=w.current_weather.windspeed;
$("pressure").textContent=Math.round(w.hourly.surface_pressure.at(-1));
$("elevation").textContent=Math.round(e.elevation);

const pm=a.hourly.pm2_5.at(-1);
const aqi=PM25(pm);
$("aqi").textContent=aqi;
$("aqiLabel").textContent=labelAQI(aqi);

$("rainNow").textContent=w.hourly.precipitation.at(-1);
$("rain3h").textContent=w.hourly.precipitation.slice(-3).reduce((x,y)=>x+y,0).toFixed(1);

/* GRAPHS */
$("aqiGraph").innerHTML="";
a.hourly.pm2_5.slice(-24).forEach((v,i)=>$("aqiGraph").innerHTML+=bar("","",PM25(v),300,"aqi",i));

$("tempGraph").innerHTML="";
w.hourly.temperature_2m.slice(-24).forEach((v,i)=>$("tempGraph").innerHTML+=bar("","",v,45,"temp",i));

/* 7 DAY */
$("temp7d").innerHTML="";
w.daily.temperature_2m_max.forEach((v,i)=>{
$("temp7d").innerHTML+=`
<div class="card">
<h4>Day ${i+1}</h4>
<div class="value">${v}¬∞</div>
<small>${w.daily.temperature_2m_min[i]}¬∞</small>
</div>`;
});
}

async function searchCity(){
const q=$("search").value;
if(!q)return;
const g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1`).then(r=>r.json());
if(g.results) load(g.results[0].latitude,g.results[0].longitude,g.results[0].name);
}

function useLocation(){
navigator.geolocation.getCurrentPosition(
p=>load(p.coords.latitude,p.coords.longitude,"Current Location"),
()=>load(22.5726,88.3639,"Kolkata, India")
);
}

/* DEFAULT */
load(22.5726,88.3639,"Kolkata, India");

/* SW */
if("serviceWorker"in navigator)navigator.serviceWorker.register("sw.js");
</script>
</body>
</html>
