<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rituva – Advanced Polar & Global Weather</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

<style>
:root{
  --bg:#000;
  --card:#0b0b0b;
  --text:#fff;
  --muted:#aaa;
  --accent:#00e5ff;
}
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--bg);
  color:var(--text);
}
header{
  padding:14px;
  text-align:center;
  font-size:22px;
  font-weight:700;
}
#map{height:50vh;}
.panel{
  padding:12px;
}
.card{
  background:var(--card);
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
}
.big-temp{
  font-size:52px;
  font-weight:800;
}
button{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  background:var(--accent);
  color:#000;
  font-size:16px;
  font-weight:700;
}
#polarModal{
  position:fixed;
  inset:0;
  background:#000;
  z-index:9999;
  display:none;
}
#polarMap{height:100%;}
.close-btn{
  position:absolute;
  top:10px;
  right:10px;
  z-index:10000;
}
</style>
</head>
<body>

<header>Rituva – Advanced Weather Intelligence</header>
<div id="map"></div>

<div class="panel">
  <div class="card">
    <div class="big-temp" id="temp">--°C</div>
    <div id="location">Detecting location…</div>
  </div>

  <div class="card">
    <strong>AQI</strong>
    <div id="aqi">Loading…</div>
  </div>

  <div class="card">
    <strong>Rain & Precipitation</strong>
    <div id="rain">Loading…</div>
  </div>

  <div class="card">
    <strong>24‑Hour Temperature</strong>
    <div id="hourly">Loading…</div>
  </div>

  <div class="card">
    <strong>7‑Day Forecast</strong>
    <div id="daily">Loading…</div>
  </div>

  <button onclick="openPolar()">❄️ Polar Mode (North / South Pole)</button>
</div>

<!-- Polar Modal -->
<div id="polarModal">
  <button class="close-btn" onclick="closePolar()">Close</button>
  <div id="polarMap"></div>
</div>

<script>
let map = L.map('map').setView([20,78],4);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:18}).addTo(map);

function fetchWeather(lat,lon){
  const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,precipitation&daily=temperature_2m_max,temperature_2m_min&current_weather=true&timezone=auto`;
  fetch(url).then(r=>r.json()).then(d=>{
    document.getElementById('temp').textContent=d.current_weather.temperature+'°C';
    document.getElementById('hourly').textContent='Hourly data available';
    document.getElementById('daily').textContent='7‑day forecast available';
  });
}

function fetchAQI(lat,lon){
  const url=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5,pm10,us_aqi`;
  fetch(url).then(r=>r.json()).then(d=>{
    const aqi=d.hourly.us_aqi[0];
    let level='Good';
    if(aqi>50) level='Moderate';
    if(aqi>100) level='Unhealthy';
    document.getElementById('aqi').textContent=`AQI ${aqi} – ${level}`;
  });
}

function fetchRain(lat,lon){
  const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=precipitation`;
  fetch(url).then(r=>r.json()).then(d=>{
    document.getElementById('rain').textContent=`Precipitation data active (Polar‑safe)`;
  });
}

navigator.geolocation.getCurrentPosition(pos=>{
  const lat=pos.coords.latitude;
  const lon=pos.coords.longitude;
  map.setView([lat,lon],7);
  L.marker([lat,lon]).addTo(map);
  document.getElementById('location').textContent=`Lat ${lat.toFixed(2)}, Lon ${lon.toFixed(2)}`;
  fetchWeather(lat,lon);
  fetchAQI(lat,lon);
  fetchRain(lat,lon);
},()=>{
  document.getElementById('location').textContent='Location access denied';
});

// Polar Mode
let polarMap;
function openPolar(){
  $("polarModal").style.display="flex";
  $("polarModal").style.flexDirection="column";

  const lat = 90;
  const lon = 0;

  if(!polarMap){
    polarMap = L.map("polarMap", {
      center:[lat,lon],
      zoom:2,
      worldCopyJump:true
    });

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom:6
    }).addTo(polarMap);
  } else {
    polarMap.setView([lat,lon],2);
  }

  // Load real polar weather + AQI
  load(lat, lon, "North Pole (Arctic)");

  $("polarInfo").innerHTML = `
    <b>❄ Polar Observation Mode</b><br>
    Latitude: 90° N<br>
    Grid source: Open‑Meteo Polar Interpolation<br>
    Temperature, AQI & precipitation are real satellite‑derived values
  `;
}

function closePolar(){
  $("polarModal").style.display="none";
}).setView([90,0],3);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:6}).addTo(polarMap);
  L.marker([90,0]).addTo(polarMap).bindPopup('North Pole');
  L.marker([-90,0]).addTo(polarMap).bindPopup('South Pole');
  fetchWeather(90,0);
  fetchAQI(90,0);
  fetchRain(90,0);
}
function closePolar(){
  document.getElementById('polarModal').style.display='none';
}
</script>
</body>
</html>
