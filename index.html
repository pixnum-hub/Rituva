<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rituva</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#667eea">

<style>
*{box-sizing:border-box;font-family:system-ui,sans-serif}
body{
  margin:0;min-height:100vh;display:flex;justify-content:center;
  padding:12px;background:linear-gradient(135deg,#667eea,#764ba2)
}
.app{
  width:100%;max-width:380px;min-height:100vh;padding:16px;
  border-radius:22px;background:rgba(255,255,255,.18);
  backdrop-filter:blur(16px);color:#000;position:relative
}
input,button{
  width:100%;padding:12px;border-radius:12px;border:none;margin-bottom:10px
}
button{font-weight:bold;background:rgba(255,255,255,.35)}
.icon{font-size:48px;text-align:center}
.details{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.detail-card,.feature-card{
  background:rgba(255,255,255,.25);
  border-radius:16px;padding:12px;text-align:center
}
.big{font-size:26px;font-weight:bold}
.hourly,.forecast{
  display:flex;gap:10px;overflow-x:auto;margin-top:10px;padding-bottom:6px
}
.hour,.day{display:flex;flex-direction:column;align-items:center}
.hour-bar,.day-bar-max,.day-bar-min{
  width:22px;border-radius:6px 6px 0 0
}
.day-bar-container{display:flex;flex-direction:column-reverse;height:80px}
.loading-overlay{
  position:absolute;inset:0;display:none;
  align-items:center;justify-content:center;
  background:rgba(255,255,255,.35);
  backdrop-filter:blur(8px);
  font-size:18px;border-radius:22px;z-index:10
}
.feature-title{font-weight:bold;font-size:13px}

@media(prefers-color-scheme:dark){
  body{background:linear-gradient(135deg,#0f2027,#203a43,#2c5364)}
  .app{background:rgba(0,0,0,.35);color:#fff}
}
</style>
</head>

<body>
<div class="app">
  <h1>ğŸŒ¦ Rituva</h1>

  <button id="installBtn" style="display:none">ğŸ“² Install Rituva</button>

  <input id="cityInput" placeholder="Search city">
  <button id="searchBtn">Search</button>
  <button id="locBtn">ğŸ“ Use My Location</button>

  <div class="loading-overlay" id="loading">Loadingâ€¦</div>

  <h2 id="location">Loading weatherâ€¦</h2>
  <div id="icon" class="icon">â›…</div>

  <p id="temp">--Â°</p>
  <p id="feels">Feels like --</p>
  <p id="wind">Wind --</p>
  <p id="humidity">Humidity --</p>
  <p id="updated">Updated --</p>

  <div class="details">
    <div class="detail-card">
      <h4>ğŸ§­ Wind Dir</h4>
      <div id="windDir" class="big">--</div>
    </div>
    <div class="detail-card">
      <h4>ğŸŒ« AQI (PM2.5)</h4>
      <div id="aqiValue" class="big">--</div>
      <div id="aqiLabel">--</div>
    </div>
  </div>

  <h3>ğŸŒ« Air Quality Details</h3>
  <div class="details" id="aqiFeatures"></div>

  <h3>ğŸ“ Location Conditions</h3>
  <div class="details" id="locationFeatures"></div>

  <h3>ğŸ•’ Next 24 Hours</h3>
  <div class="hourly" id="hourly"></div>

  <h3>ğŸ“… 7-Day Forecast</h3>
  <div class="forecast" id="forecast"></div>

  <footer style="margin-top:20px;font-size:11px;text-align:center">
    Â© Manik Roy 2025
  </footer>
</div>

<script>
const $ = id => document.getElementById(id);
const loading = $("loading");
const icons = {0:"â˜€",1:"ğŸŒ¤",2:"â›…",3:"â˜",45:"ğŸŒ«",61:"ğŸŒ§",71:"â„",95:"â›ˆ"};

function showLoading(v){ loading.style.display = v?"flex":"none"; }
function compass(d){return["N","NE","E","SE","S","SW","W","NW"][Math.round(d/45)%8];}

// AQI FEATURES
function renderAQIFeatures(pm){
  const level = pm<=30?"Good":pm<=60?"Moderate":pm<=90?"Poor":pm<=120?"Unhealthy":"Severe";
  const data=[
  ["AQI Level",level],["Health Risk",level==="Good"?"Safe":"High"],
  ["Outdoor Advice",level==="Good"?"Go out":"Avoid"],
  ["Mask Needed",pm>60?"Yes":"No"],
  ["Children Safety",pm>40?"Care":"Safe"],
  ["Elder Safety",pm>50?"Risk":"Safe"],
  ["Asthma Risk",pm>30?"High":"Low"],
  ["Visibility",pm>80?"Low":"Clear"],
  ["Pollution Type","PM2.5"],
  ["AQI Category",level]
  ];
  $("aqiFeatures").innerHTML="";
  data.forEach(x=>{
    $("aqiFeatures").innerHTML+=`
    <div class="feature-card">
      <div class="feature-title">${x[0]}</div>
      <div>${x[1]}</div>
    </div>`;
  });
}

// LOCATION FEATURES
function renderLocationFeatures(w){
  const data=[
  ["Latitude",w.latitude],
  ["Longitude",w.longitude],
  ["Timezone",w.timezone],
  ["Elevation",w.elevation+" m"],
  ["Day/Night",new Date().getHours()>6&&new Date().getHours()<18?"Day":"Night"],
  ["Heat Index",w.current_weather.temperature+"Â°C"],
  ["Wind Level",w.current_weather.windspeed<10?"Low":"High"],
  ["Humidity Type",w.hourly.relativehumidity_2m[0]>60?"Humid":"Dry"],
  ["Weather Type",icons[w.current_weather.weathercode]],
  ["Climate Mode",w.current_weather.temperature>30?"Hot":"Cool"]
  ];
  $("locationFeatures").innerHTML="";
  data.forEach(x=>{
    $("locationFeatures").innerHTML+=`
    <div class="feature-card">
      <div class="feature-title">${x[0]}</div>
      <div>${x[1]}</div>
    </div>`;
  });
}

// MAIN API
async function loadWeather(lat,lon,name){
try{
showLoading(true);
const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,apparent_temperature,relativehumidity_2m&daily=temperature_2m_min,temperature_2m_max,weathercode&timezone=auto`).then(r=>r.json());

const a=await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5&timezone=auto`).then(r=>r.json());

$("location").textContent=name;
$("temp").textContent=w.current_weather.temperature+"Â°C";
$("feels").textContent="Feels like "+w.hourly.apparent_temperature[0]+"Â°C";
$("wind").textContent="Wind "+w.current_weather.windspeed+" km/h";
$("humidity").textContent="Humidity "+w.hourly.relativehumidity_2m[0]+"%";
$("windDir").textContent=compass(w.current_weather.winddirection);
$("icon").textContent=icons[w.current_weather.weathercode];
$("updated").textContent="Updated "+new Date().toLocaleTimeString();

const pm=a.hourly.pm2_5[0];
$("aqiValue").textContent=pm;
$("aqiLabel").textContent=pm<=30?"Good":pm<=60?"Moderate":pm<=90?"Poor":"Severe";

renderAQIFeatures(pm);
renderLocationFeatures(w);

buildHourly(w.hourly.temperature_2m.slice(0,24));
buildForecast(w.daily);

localStorage.setItem("rituva_last",JSON.stringify({lat,lon,name}));

}catch{alert("Weather failed");}
finally{showLoading(false);}
}

// GRAPHS
function buildHourly(t){
$("hourly").innerHTML="";
const min=Math.min(...t),max=Math.max(...t),r=max-min||1;
t.forEach(v=>{
$("hourly").innerHTML+=`
<div class="hour">
<div class="hour-bar" style="height:${30+((v-min)/r)*80}px;background:#4fc3f7"></div>
<small>${v}Â°</small></div>`});
}

function buildForecast(d){
$("forecast").innerHTML="";
d.time.forEach((x,i)=>{
$("forecast").innerHTML+=`
<div class="day">
<div class="day-bar-container">
<div class="day-bar-max" style="height:60px;background:#ff7043"></div>
<div class="day-bar-min" style="height:40px;background:#42a5f5"></div>
</div>
<div>${icons[d.weathercode[i]]}</div>
<small>${x.slice(5)}</small></div>`});
}

// SEARCH
$("searchBtn").onclick=async()=>{
const q=$("cityInput").value.trim();
if(!q)return;
const r=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1`).then(r=>r.json());
if(r.results)loadWeather(r.results[0].latitude,r.results[0].longitude,r.results[0].name);
};

// LOCATION
$("locBtn").onclick=()=>{
navigator.geolocation.getCurrentPosition(p=>
loadWeather(p.coords.latitude,p.coords.longitude,"Current Location"));
};

// BOOT
(function(){
const c=JSON.parse(localStorage.getItem("rituva_last")||"null");
c?loadWeather(c.lat,c.lon,c.name):loadWeather(28.61,77.23,"Delhi, India");
})();

// PWA
if("serviceWorker"in navigator){
navigator.serviceWorker.register("sw.js");
}

let deferredPrompt;
window.addEventListener("beforeinstallprompt",e=>{
e.preventDefault();deferredPrompt=e;
$("installBtn").style.display="block";
});

$("installBtn").onclick=async()=>{
$("installBtn").style.display="none";
await deferredPrompt.prompt();
};
</script>
</body>
</html>
