<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rituva</title>

<!-- Manifest for PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#667eea">

<style>
/* ==== BASE ==== */
*{box-sizing:border-box;font-family:system-ui,sans-serif}
body{margin:0;min-height:100vh;display:flex;justify-content:center;align-items:center;transition:background 0.3s,color 0.3s;}
body{background:linear-gradient(135deg,#667eea,#764ba2);color:#000;}
.app{width:100%;max-width:380px;padding:20px;border-radius:20px;backdrop-filter:blur(18px);background:rgba(255,255,255,0.15);transition:background 0.3s,color 0.3s;}
input,button{width:100%;padding:12px;border-radius:12px;border:none;margin-bottom:10px;transition:background 0.3s,color 0.3s;}
button{background: rgba(255,255,255,0.35); font-weight:bold;}
.icon{font-size:48px;text-align:center;}
.details{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:15px;}
.detail-card{background: rgba(255,255,255,0.2);border-radius:16px;padding:12px;text-align:center;transition: background 0.3s,color 0.3s;}
.big{font-size:26px;font-weight:bold;}
.label{font-size:13px;}
.hint{font-size:12px;margin-top:6px;}
.hourly{display:flex;gap:6px;overflow-x:auto;margin-top:10px;align-items:end;height:120px;}
.hour{min-width:24px;display:flex;flex-direction: column;justify-content:flex-end;align-items:center;}
.hour-bar{width:18px;border-radius:6px 6px 0 0;margin-bottom:4px;transition: background 0.3s,height 0.3s;}
.hour-label{font-size:11px;margin-top:2px;color:inherit;}
.forecast{display:flex;gap:10px;overflow-x:auto;margin-top:10px;align-items:end;height:120px;}
.day{min-width:40px;display:flex;flex-direction: column;justify-content:flex-end;align-items:center;}
.day-bar-container{display:flex;flex-direction: column;justify-content:flex-end;height:80px;width:16px;margin-bottom:4px;}
.day-bar-min,.day-bar-max{width:16px;border-radius:6px 6px 0 0;margin-bottom:2px;transition:background 0.3s,height 0.3s;}
.day-bar-min{background: rgba(0,150,255,0.6);}
.day-bar-max{background: rgba(255,80,50,0.7);}
.day-label{font-size:11px;margin-top:2px;color:inherit;}
@media(max-width:420px){.details{grid-template-columns:1fr;}}
.aqi-good{color:#00e676;}
.aqi-moderate{color:#ffeb3b;}
.aqi-poor{color:#ff9800;}
.aqi-severe{color:#f44336;}
@media (prefers-color-scheme: dark){
  body{background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);color:#fff;}
  .app{background: rgba(0,0,0,0.25);color:#fff;}
  input,button{background: rgba(255,255,255,0.1);color:#fff;}
  .detail-card{background: rgba(0,0,0,0.35);}
  .hour-bar,.day-bar-max,.day-bar-min{transition: background 0.3s,height 0.3s;}
  .hour-label,.day-label{color:#fff;}
}
</style>
</head>
<body>
<div class="app">
  <h1>ðŸŒ¦ Rituva</h1>
  <input id="cityInput" placeholder="Search city">
  <button onclick="searchCity()">Search</button>

  <div class="current">
    <h2 id="location">Your Location</h2>
    <div id="icon" class="icon">â›…</div>
    <p id="temp">--Â°C</p>
    <p id="wind">-- km/h</p>
    <p id="pressure">-- hPa</p>
  </div>

  <div class="details">
    <div class="detail-card">
      <h4>ðŸ§­ Wind Direction</h4>
      <div id="compassValue" class="big">--Â°</div>
      <div id="compassDir" class="label">Direction: --</div>
    </div>
    <div class="detail-card">
      <h4>ðŸŒ« Air Quality Index (PM2.5)</h4>
      <div id="aqiValue" class="big">--</div>
      <div id="aqiLabel" class="label">Category: --</div>
      <div id="aqiAdvice" class="hint">--</div>
    </div>
  </div>

  <h3>ðŸ•’ Next 24 Hours</h3>
  <div class="hourly" id="hourlyTemp"></div>

  <h3>ðŸ“… 7-Day Forecast (Min / Max)</h3>
  <div class="forecast" id="forecast"></div>
</div>

<script>
// ICONS
const icons={0:"â˜€",1:"ðŸŒ¤",2:"â›…",3:"â˜",45:"ðŸŒ«",61:"ðŸŒ§",71:"â„",95:"â›ˆ"};

// COMPASS
function compassDirection(d){const a=["North","NE","East","SE","South","SW","West","NW"];return a[Math.round(d/45)%8];}
if("DeviceOrientationEvent" in window){
  window.addEventListener("deviceorientation", e=>{
    if(e.alpha!=null){
      compassValue.innerText=`${Math.round(e.alpha)}Â°`;
      compassDir.innerText=`Direction: ${compassDirection(e.alpha)}`;
    }
  });
}

// AQI logic
function aqiInfo(pm){
  if(pm<=30) return {l:"Good",a:"Safe outdoors"};
  if(pm<=60) return {l:"Moderate",a:"Sensitive reduce exposure"};
  if(pm<=90) return {l:"Poor",a:"Avoid long outdoor stay"};
  return {l:"Severe",a:"Stay indoors"};
}

// LOAD WEATHER
async function loadWeather(lat, lon, name, country){
  const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,surface_pressure&daily=temperature_2m_min,temperature_2m_max,weathercode&timezone=auto`).then(r=>r.json());
  const a=await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5&timezone=auto`).then(r=>r.json());

  location.innerText=`${name} ${country}`;
  temp.innerText=`ðŸŒ¡ ${w.current_weather.temperature}Â°C`;
  wind.innerText=`ðŸŒ¬ ${w.current_weather.windspeed} km/h`;
  pressure.innerText=`ðŸ“Ÿ ${w.hourly.surface_pressure[0]} hPa`;
  icon.innerText=icons[w.current_weather.weathercode]||"â›…";

  const pm=a.hourly.pm2_5[0];
  const ai=aqiInfo(pm);
  aqiValue.innerText=`${pm} Âµg/mÂ³`;
  aqiLabel.innerText=`Category: ${ai.l}`;
  aqiAdvice.innerText=`Health: ${ai.a}`;

  // HOURLY chart
  hourlyTemp.innerHTML="";
  const temps=w.hourly.temperature_2m.slice(0,24);
  const minT=Math.min(...temps), maxT=Math.max(...temps);
  temps.forEach((t,i)=>{
    const h=20+((t-minT)/(maxT-minT))*100;
    const r=Math.min(255,Math.round((t-minT)/(maxT-minT)*255));
    const b=255-r;
    const color=`rgb(${r},50,${b})`;
    hourlyTemp.innerHTML+=`<div class="hour"><div class="hour-bar" style="height:${h}px;background:${color};"></div><div class="hour-label">${i}h</div></div>`;
  });

  // 7-DAY forecast
  forecast.innerHTML="";
  const dailyMin=w.daily.temperature_2m_min;
  const dailyMax=w.daily.temperature_2m_max;
  const minAll=Math.min(...dailyMin);
  const maxAll=Math.max(...dailyMax);
  w.daily.time.forEach((d,i)=>{
    const minH=20+((dailyMin[i]-minAll)/(maxAll-minAll))*60;
    const maxH=20+((dailyMax[i]-minAll)/(maxAll-minAll))*60;
    forecast.innerHTML+=`<div class="day"><div class="day-bar-container"><div class="day-bar-max" style="height:${maxH}px"></div><div class="day-bar-min" style="height:${minH}px"></div></div><div>${icons[w.daily.weathercode[i]]||"â›…"}</div><div class="day-label">${d.slice(5)}</div></div>`;
  });
}

// SEARCH CITY
async function searchCity(){
  const city=cityInput.value;
  if(!city) return;
  const g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1`).then(r=>r.json());
  if(!g.results) return alert("City not found");
  const {latitude,longitude,name,country}=g.results[0];
  loadWeather(latitude,longitude,name,country);
}

// CURRENT LOCATION
navigator.geolocation.getCurrentPosition(p=>{loadWeather(p.coords.latitude,p.coords.longitude,"Your Location","");});

// ==== PWA SERVICE WORKER ====
if('serviceWorker' in navigator){
  window.addEventListener('load', ()=>{
    navigator.serviceWorker.register('./sw.js').then(reg=>{
      console.log("SW registered", reg);
    }).catch(err=>{
      console.log("SW registration failed", err);
    });
  });
}
</script>
</body>
</html>
