<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rituva</title>

<style>
:root{
  --bg:#000000;
  --card:#121212;
  --text:#ffffff;
  --muted:#cfcfcf;
}
.light{
  --bg:#f4f4f4;
  --card:#ffffff;
  --text:#000000;
  --muted:#555555;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  font-size:18px; /* mobile-first base */
  line-height:1.6;
  -webkit-text-size-adjust:100%;
}
.app{
  max-width:480px;
  margin:0 auto;
  padding-bottom:28px;
  padding-left:env(safe-area-inset-left);
  padding-right:env(safe-area-inset-right);
}
.app-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 14px;
  position:sticky;
  top:0;
  background:var(--bg);
  z-index:10;
}
.title{font-size:26px;font-weight:800;}
.city{font-size:18px;color:var(--muted);}
.toggle{font-size:18px;padding:8px 12px;border-radius:20px;border:none;background:var(--card);color:var(--text);cursor:pointer;}
.controls{
  display:grid;
  grid-template-columns:1fr auto auto;
  gap:10px;
  padding:12px 14px;
}
@media(max-width:420px){
  .controls{
    grid-template-columns:1fr;
  }
  .controls button{
    width:100%;
  }
}
input,button{
  padding:14px;
  font-size:16px;
  border-radius:14px;
  border:none;
  min-height:48px; /* touch target */
}
input{flex:1}
section{padding:14px;}
h2{
  margin:12px 0 14px;
  font-size:20px;
}
.cards{display:flex;flex-direction:column;gap:14px;}
.card{background:var(--card);padding:16px;border-radius:16px;}
.card b{
  display:block;
  margin-top:8px;
  font-size:32px;
  font-weight:800;
}
.main-temp b{
  font-size:48px; /* extra-large main temperature */
  line-height:1.1;
}
small{font-size:15px;color:var(--muted);}
footer{text-align:center;padding:16px;font-size:15px;color:var(--muted);}
@media(min-width:768px){
  body{
    display:flex;
    justify-content:center;
  }
  .cards{
    flex-direction:row;
    flex-wrap:wrap;
    gap:16px;
  }
  .card{
    flex:1 1 calc(50% - 16px);
  }
  h2{font-size:22px;}
}
  .cards{flex-direction:row;flex-wrap:wrap;gap:16px;}
  .card{flex:1 1 calc(50% - 16px);}
}
</style>
</head>
<body>
<div class="app">

<div class="app-header">
  <div>
    <div class="title">Rituva</div>
    <div class="city" id="city">Locatingâ€¦</div>
  </div>
  <button class="toggle" onclick="toggleTheme()">ğŸŒ™</button>
</div>

<div class="controls">
  <input id="search" placeholder="Search city" onkeydown="if(event.key==='Enter')searchCity()">
  <button onclick="searchCity()">Search</button>
  <button onclick="useMyLocation()">ğŸ“</button>
</div>

<section>
<h2>ğŸŒ¡ Current Conditions</h2>
<div class="cards">
  <div class="card main-temp">Temperature<b id="temp">--</b></div>
  <div class="card">24h Min / Max<b id="temp24">--</b></div>
  <div class="card">Feels Comfort<b id="feels">--</b></div>
  <div class="card">Humidity<b id="humidity">--</b></div>
  <div class="card">Wind<b id="wind">--</b></div>
</div>
</section>

<section>
<h2>ğŸŒ§ Rain & Forecast</h2>
<div class="cards">
  <div class="card">Rain Intensity<b id="rainIntensity">--</b></div>
  <div class="card">Rain Probability<b id="rainProb">--</b></div>
  <div class="card">24h Rain Total<b id="rain24">--</b></div>
  <div class="card">Heavy Rain Risk<b id="stormETA">--</b></div>
  <div class="card">Road / Commute<b id="roadRisk">--</b></div>
</div>
</section>

<section>
<h2>ğŸŒ¬ Air Quality</h2>
<div class="cards">
  <div class="card">PM2.5 (Âµg/mÂ³)<b id="pm25">--</b><small>Converted to health bands</small></div>
  <div class="card">Children Impact<b id="aqiChild">--</b></div>
  <div class="card">Elderly Impact<b id="aqiOld">--</b></div>
  <div class="card">Asthma Impact<b id="aqiAsthma">--</b></div>
</div>
</section>

<section>
<h2>ğŸŒ Heat & Cold Stress</h2>
<div class="cards">
  <div class="card">UV Index<b id="uv">--</b></div>
  <div class="card">Sunburn Risk<b id="sunburn">--</b></div>
  <div class="card">Wet-Bulb Temp<b id="wetbulb">--</b></div>
  <div class="card">Cold Exposure<b id="coldRisk">--</b></div>
</div>
</section>

<section>
<h2>ğŸ§  Human Impact</h2>
<div class="cards">
  <div class="card">Weather Mood<b id="mood">--</b></div>
  <div class="card">Productivity<b id="productivity">--</b></div>
  <div class="card">Best Outdoor Time<b id="bestTime">--</b></div>
</div>
<small>Indicative insights. Not medical advice.</small>
</section>

<section>
<h2>ğŸ“† 7â€‘Day Temperature</h2>
<div class="cards">
  <div class="card">7â€‘Day Min / Max<b id="temp7">--</b></div>
</div>
</section>

<section>
<h2>ğŸŒ… Sun & Trust</h2>
<div class="cards">
  <div class="card">Sunrise / Sunset<b id="sun">--</b></div>
  <div class="card">Golden Hour<b id="golden">--</b></div>
  <div class="card">Data Confidence<b>Medium</b></div>
  <div class="card">Last Updated<b id="updated">--</b></div>
</div>
</section>

<footer>Â© Manik Roy 2025. All Rights Reserved.</footer>
</div>

<script>
const city=document.getElementById('city');
const temp=document.getElementById('temp');
const feels=document.getElementById('feels');
const humidity=document.getElementById('humidity');
const wind=document.getElementById('wind');
const temp24=document.getElementById('temp24');
const rain24=document.getElementById('rain24');
const temp7=document.getElementById('temp7');
const rainIntensity=document.getElementById('rainIntensity');
const rainProb=document.getElementById('rainProb');
const stormETA=document.getElementById('stormETA');
const roadRisk=document.getElementById('roadRisk');
const pm25=document.getElementById('pm25');
const aqiChild=document.getElementById('aqiChild');
const aqiOld=document.getElementById('aqiOld');
const aqiAsthma=document.getElementById('aqiAsthma');
const uv=document.getElementById('uv');
const sunburn=document.getElementById('sunburn');
const wetbulb=document.getElementById('wetbulb');
const coldRisk=document.getElementById('coldRisk');
const mood=document.getElementById('mood');
const productivity=document.getElementById('productivity');
const bestTime=document.getElementById('bestTime');
const sun=document.getElementById('sun');
const golden=document.getElementById('golden');
const updated=document.getElementById('updated');

function toggleTheme(){
  document.body.classList.toggle('light');
  localStorage.setItem('theme',document.body.classList.contains('light')?'light':'dark');
}
if(localStorage.getItem('theme')==='light')document.body.classList.add('light');

function wetBulbTemp(t,h){
  return (t*Math.atan(0.151977*Math.sqrt(h+8.313659))
  +Math.atan(t+h)-Math.atan(h-1.676331)
  +0.00391838*Math.pow(h,1.5)*Math.atan(0.023101*h)-4.686035).toFixed(1);
}

function addHour(time,offset){
  let [h,m]=time.split(':').map(Number);
  h=(h+offset+24)%24;
  return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
}

async function load(lat,lon,name){
  // Reverse geocoding for accurate city name
  if(name==='My Location'){
    try{
      const geo=await fetch(`https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&count=1`).then(r=>r.json());
      if(geo.results && geo.results.length>0){
        const r = geo.results[0];
        city.innerText = r.name + (r.country ? ', ' + r.country : '');
      } else {
        city.innerText = 'My Location';
      }
    } catch {
      city.innerText = 'My Location';
    }
  } else {
    city.innerText = name;
  }
  city.innerText=name;
  const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,relative_humidity_2m,precipitation_probability,precipitation,wind_speed_10m&daily=sunrise,sunset,uv_index_max&current_weather=true&timezone=auto`).then(r=>r.json());
  const a=await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5`).then(r=>r.json());

  let idx=w.hourly.time.indexOf(w.current_weather.time);
  if(idx===-1) idx=0; // fallback for API time mismatch
  const t=w.current_weather.temperature;
  
  // 24h temperature min/max
  const temps24=w.hourly.temperature_2m.slice(idx,idx+24);
  const min24=Math.min(...temps24);
  const max24=Math.max(...temps24);

  // 24h rain sum
  const rain24sum=w.hourly.precipitation.slice(idx,idx+24).reduce((a,b)=>a+b,0);

  // 7-day min/max
  const min7=Math.min(...w.daily.temperature_2m_min);
  const max7=Math.max(...w.daily.temperature_2m_max);
  const h=w.hourly.relative_humidity_2m[idx];
  const windv=w.current_weather.windspeed;
  const rainP=w.hourly.precipitation_probability ? w.hourly.precipitation_probability[idx] : 0;
  const rainMM=w.hourly.precipitation ? w.hourly.precipitation[idx] : 0;
  const pm=a.hourly.pm2_5 ? a.hourly.pm2_5[idx] : null;

  temp.innerText=`${t}Â°C`;
  temp24.innerText=`${min24.toFixed(1)}Â° / ${max24.toFixed(1)}Â°`;
  rain24.innerText=`${rain24sum.toFixed(1)} mm`;
  temp7.innerText=`${min7.toFixed(1)}Â° / ${max7.toFixed(1)}Â°`;
  feels.innerText=`${(t+0.05*h-0.15*windv).toFixed(1)}Â°C`;
  humidity.innerText=`${h}%`;
  wind.innerText=`${windv} km/h`;

  rainProb.innerText=`${rainP}%`;
  rainIntensity.innerText=rainMM===0?'None':rainMM<2?'Light':rainMM<10?'Moderate':'Heavy';
  stormETA.innerText=rainMM>=10?'High':'Low';
  roadRisk.innerText=rainMM>=10?'Avoid':rainMM>=2?'Caution':'Safe';

  pm25.innerText = pm !== null ? Math.round(pm) : 'N/A';
  aqiChild.innerText = pm === null ? 'N/A' : (pm>35?'High':'Low');
  aqiOld.innerText = pm === null ? 'N/A' : (pm>55?'High':'Moderate');
  aqiAsthma.innerText = pm === null ? 'N/A' : (pm>25?'High':'Low');

  const uvmax=w.daily.uv_index_max[0];
  uv.innerText=uvmax;
  sunburn.innerText=uvmax>=8?'Severe':uvmax>=5?'High':'Low';

  wetbulb.innerText=`${wetBulbTemp(t,h)}Â°C`;
  coldRisk.innerText=t<=8?'High':'Low';

  mood.innerText=rainMM>=10?'Irritable':t>=35?'Drained':'Calm';
  productivity.innerText=(t>=20&&t<=30&&rainMM<2)?'High':'Low';
  bestTime.innerText=(uvmax<6&&rainMM<2)?'Morning':'Evening';

  const sunrise=w.daily.sunrise[0].slice(11,16);
  const sunset=w.daily.sunset[0].slice(11,16);
  sun.innerText=`${sunrise} / ${sunset}`;
  golden.innerText=`${sunrise}â€“${addHour(sunrise,1)} / ${addHour(sunset,-1)}â€“${sunset}`;

  updated.innerText=new Date().toLocaleTimeString();
}

function useMyLocation(){
  navigator.geolocation.getCurrentPosition(
    p=>load(p.coords.latitude,p.coords.longitude,'My Location'),
    ()=>load(22.57,88.36,'Kolkata')
  );
}
async function searchCity(){
  const q=document.getElementById('search').value;
  if(!q)return;
  const g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1`).then(r=>r.json());
  if(g.results)load(g.results[0].latitude,g.results[0].longitude,g.results[0].name);
}
useMyLocation();
</script>
</body>
</html>
