<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rituva â€“ Weather Intelligence</title>

<style>
:root{
  --bg:#000;
  --card:#141414;
  --text:#fff;
  --muted:#aaa;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
}
.container{
  max-width:480px;
  margin:auto;
  padding:16px 16px 80px;
}
h1{font-size:30px;margin:6px 0 14px}
h2{margin:22px 0 10px;font-size:20px}
input,button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:16px;
  font-size:16px;
  margin-bottom:10px;
}
input{background:#111;color:#fff}
button{background:#1f1f1f;color:#fff}
.cards{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
.card{
  background:var(--card);
  padding:16px;
  border-radius:18px;
  text-align:center;
}
.big{
  font-size:56px;
  font-weight:700;
  text-align:center;
}
small{color:var(--muted)}
.footer{
  margin-top:40px;
  text-align:center;
  color:#666;
  font-size:13px;
}
</style>
</head>

<body>
<div class="container">

<h1>ğŸŒ¦ Rituva</h1>

<input id="cityInput" placeholder="Search city">
<button onclick="searchCity()">Search</button>
<button onclick="useMyLocation()">ğŸ“ Use My Location</button>

<h2 id="locationName">Detecting locationâ€¦</h2>
<div class="big" id="currentTemp">--Â°C</div>

<h2>ğŸŒ¡ Temperature</h2>
<div class="cards">
  <div class="card">Today Min<br><b id="todayMin">--Â°</b></div>
  <div class="card">Today Max<br><b id="todayMax">--Â°</b></div>
  <div class="card">Next 24H Min<br><b id="temp24Min">--Â°</b></div>
  <div class="card">Next 24H Max<br><b id="temp24Max">--Â°</b></div>
</div>

<h2>ğŸ“… 7-Day Temperature</h2>
<div id="weekTemp" class="cards"></div>

<h2>ğŸŒ« AQI</h2>
<div class="cards">
  <div class="card">Current AQI<br><b id="aqiNow">--</b><br><small id="aqiCat"></small></div>
  <div class="card">Mask Advice<br><small id="maskAdvice">--</small></div>
  <div class="card">AQI 24H Min<br><b id="aqi24Min">--</b></div>
  <div class="card">AQI 24H Max<br><b id="aqi24Max">--</b></div>
</div>

<h2>ğŸŒ§ Rain</h2>
<div class="cards">
  <div class="card">Rain Now<br><b id="rainNow">-- mm</b></div>
  <div class="card">Rain Probability<br><b id="rainProb">--%</b></div>
  <div class="card">24H Min Rain<br><b id="rain24Min">-- mm</b></div>
  <div class="card">24H Max Rain<br><b id="rain24Max">-- mm</b></div>
</div>

<div class="cards">
  <div class="card">Next 3H Alert<br><small id="rainAlert">--</small></div>
  <div class="card">Thunderstorm<br><small id="stormAlert">--</small></div>
</div>

<h2>ğŸŒ¾ Rain Intelligence</h2>
<div class="cards">
  <div class="card">Rain Usefulness<br><b id="rainScore">--</b><br><small id="rainScoreText">--</small></div>
  <div class="card">Monsoon Status<br><b id="monsoonIndex">--</b><br><small id="monsoonText">--</small></div>
</div>

<h2>ğŸ”¥ Heat & Comfort</h2>
<div class="cards">
  <div class="card">Heatwave Probability<br><b id="heatProb">--%</b><br><small id="heatProbText">--</small></div>
  <div class="card">Feels-like Difference<br><b id="feelDiff">--Â°C</b><br><small id="feelText">--</small></div>
</div>

<h2>ğŸŒ™ Day / Night Avg</h2>
<div class="cards">
  <div class="card">Day Avg<br><b id="dayTemp">--Â°C</b></div>
  <div class="card">Night Avg<br><b id="nightTemp">--Â°C</b></div>
</div>

<h2>ğŸ§  Health & Agriculture</h2>
<div class="cards">
  <div class="card">Sleep Comfort<br><b id="sleepScore">--</b><br><small id="sleepText">--</small></div>
  <div class="card">Elderly Heat Risk<br><b id="elderRisk">--</b><br><small id="elderText">--</small></div>
  <div class="card">Crop Heat Stress<br><b id="cropStress">--</b><br><small id="cropText">--</small></div>
</div>

<div class="footer">Â© Manik Roy 2025. All Rights Reserved.</div>
</div>

<script>
const DEF={lat:22.5726,lon:88.3639,name:"Kolkata, India"};

const pm25ToAQI=pm=>{
const bp=[[0,12,0,50],[12.1,35.4,51,100],[35.5,55.4,101,150],
[55.5,150.4,151,200],[150.5,250.4,201,300],[250.5,500,301,500]];
for(const[bL,bH,aL,aH]of bp)
if(pm>=bL&&pm<=bH)return Math.round(((aH-aL)/(bH-bL))*(pm-bL)+aL);
return 500;
};
const AQICat=a=>a<50?"Good":a<100?"Moderate":a<200?"Poor":a<300?"Very Poor":"Severe";
const Mask=a=>a<50?"Not required":a<100?"Optional":a<200?"Recommended":"Mandatory";

const hourIndex=(t,c)=>{
const h=c.slice(0,13);
const i=t.findIndex(x=>x.startsWith(h));
return i>=0?i:0;
};

async function loadData(lat,lon,name){
locationName.innerText=name;

const w=await fetch(
`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}
&current_weather=true
&hourly=temperature_2m,apparent_temperature,precipitation,precipitation_probability
&daily=temperature_2m_min,temperature_2m_max,precipitation_sum
&timezone=auto`
).then(r=>r.json());

const a=await fetch(
`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}
&hourly=pm2_5&timezone=auto`
).then(r=>r.json());

currentTemp.innerText=w.current_weather.temperature+"Â°C";
todayMin.innerText=w.daily.temperature_2m_min[0]+"Â°";
todayMax.innerText=w.daily.temperature_2m_max[0]+"Â°";

const idx=hourIndex(w.hourly.time,w.current_weather.time);

const t24=w.hourly.temperature_2m.slice(idx,idx+24);
temp24Min.innerText=Math.min(...t24)+"Â°";
temp24Max.innerText=Math.max(...t24)+"Â°";

weekTemp.innerHTML="";
for(let d=0;d<7;d++){
weekTemp.innerHTML+=`<div class="card">Day ${d+1}<br>
<b>${w.daily.temperature_2m_min[d]}Â°</b> / <b>${w.daily.temperature_2m_max[d]}Â°</b></div>`;
}

const pm24=a.hourly.pm2_5.slice(idx,idx+24).map(pm25ToAQI);
aqiNow.innerText=pm24[0];
aqiCat.innerText=AQICat(pm24[0]);
maskAdvice.innerText=Mask(pm24[0]);
aqi24Min.innerText=Math.min(...pm24);
aqi24Max.innerText=Math.max(...pm24);

rainNow.innerText=w.hourly.precipitation[idx].toFixed(1)+" mm";
const rain24=w.hourly.precipitation.slice(idx,idx+24);
rain24Min.innerText=Math.min(...rain24).toFixed(1)+" mm";
rain24Max.innerText=Math.max(...rain24).toFixed(1)+" mm";
rainProb.innerText=Math.max(...w.hourly.precipitation_probability.slice(idx,idx+24))+"%";
const rain3h=rain24.slice(0,3).reduce((a,b)=>a+b,0);
rainAlert.innerText=rain3h>5?"Heavy rain":"No rain";
stormAlert.innerText=rain3h>10?"Thunderstorm risk":"None";

let score=rain3h<0.5?10:rain3h<2?30:rain3h<10?60:rain3h<30?80:65;
rainScore.innerText=score+"/100";
rainScoreText.innerText=score<40?"Low benefit":score<60?"Moderate":score<80?"Very good":"Excess";

const weekRain=w.daily.precipitation_sum.reduce((a,b)=>a+b,0);
let m=weekRain>220?5:weekRain>150?4:weekRain>100?3:weekRain>50?2:weekRain>20?1:0;
monsoonIndex.innerText=m+"/5";
monsoonText.innerText=m<2?"Weak":m==2?"Normal":m==3?"Active":m==4?"Very Active":"Extreme";

const hotDays=w.daily.temperature_2m_max.slice(0,5).filter(t=>t>=40).length;
const heatProbVal=Math.round((hotDays/5)*100);
heatProb.innerText=heatProbVal+"%";
heatProbText.innerText=heatProbVal<40?"Low":heatProbVal<60?"Moderate":"High";

const actual=w.hourly.temperature_2m[idx];
const feel=w.hourly.apparent_temperature[idx];
const diff=Math.round(feel-actual);
feelDiff.innerText=(diff>=0?"+":"")+diff+"Â°C";
feelText.innerText=diff<2?"Comfortable":diff<4?"Uncomfortable":"Severe";

let day=[],night=[];
for(let i=0;i<24;i++){
const h=new Date(w.hourly.time[idx+i]).getHours();
const t=w.hourly.temperature_2m[idx+i];
(h>=6&&h<18?day:night).push(t);
}
const dayAvg=Math.round(day.reduce((a,b)=>a+b,0)/day.length);
const nightAvg=Math.round(night.reduce((a,b)=>a+b,0)/night.length);
dayTemp.innerText=dayAvg+"Â°C";
nightTemp.innerText=nightAvg+"Â°C";

let sleep=nightAvg<=24?90:nightAvg<=27?70:nightAvg<=30?50:30;
sleepScore.innerText=sleep+"/100";
sleepText.innerText=sleep>70?"Good sleep":sleep>50?"Disturbed":"Poor sleep";

const cropMax=Math.max(...w.daily.temperature_2m_max.slice(0,3));
cropStress.innerText=cropMax<35?"Safe":cropMax<40?"Mild":"Severe";
cropText.innerText=cropMax<35?"No action":cropMax<40?"Irrigation":"Crop risk";

let elder=0;
if(actual>=35)elder++;
if(diff>=3)elder++;
if(heatProbVal>=60)elder++;
elderRisk.innerText=elder<=1?"Low":elder==2?"High":"Extreme";
elderText.innerText=elder<=1?"Normal care":elder==2?"Avoid heat":"Stay indoors";
}

function autoDetect(){
navigator.geolocation?.getCurrentPosition(
p=>loadData(p.coords.latitude,p.coords.longitude,"My Location"),
()=>loadData(DEF.lat,DEF.lon,DEF.name),
{timeout:8000}
)||loadData(DEF.lat,DEF.lon,DEF.name);
}
async function searchCity(){
if(!cityInput.value)return;
const g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${cityInput.value}&count=1`).then(r=>r.json());
if(g.results){
const r=g.results[0];
loadData(r.latitude,r.longitude,r.name+", "+r.country);
}
}
function useMyLocation(){autoDetect();}
window.onload=autoDetect;
</script>

</body>
</html>
