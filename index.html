<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#000000">
<title>Rituva</title>

<style>
:root{
  --bg:#000;
  --card:#121212;
  --text:#fff;
  --muted:#9a9a9a;
  --radius:20px;
}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
  transition:0.3s;
}
main{
  max-width:420px;
  margin:auto;
  padding:16px;
  position:relative;
}
input,button{
  padding:14px;
  border:none;
  border-radius:var(--radius);
  background:#111;
  color:var(--text);
  font-size:16px;
}
h1,h2{margin:14px 0 8px}
.big-temp{
  font-size:84px;
  font-weight:700;
  text-align:center;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.card{
  background:var(--card);
  padding:14px;
  border-radius:var(--radius);
  transition:0.3s;
}
.center{text-align:center}
.label{font-size:13px;color:var(--muted)}
.value{font-size:30px;font-weight:700}
.sub{font-size:14px;color:#bbb}
.note{font-size:12px;color:#777;margin-top:4px}

.alert{
  padding:12px;
  border-radius:14px;
  text-align:center;
  font-size:15px;
}
canvas{width:100%;height:160px}
.day{
  display:flex;
  justify-content:space-between;
  padding:10px 0;
  border-bottom:1px solid #222;
}
.day:last-child{border:none}
footer{
  text-align:center;
  margin:30px 0 10px;
  font-size:12px;
  color:var(--muted);
}
/* Dark/Light Toggle Button */
#modeToggle{
  position:absolute;
  top:10px;
  right:10px;
  width:40px;
  height:40px;
  border:none;
  border-radius:50%;
  background:#111;
  color:var(--text);
  font-size:18px;
  cursor:pointer;
}
body.light{
  --bg:#f0f0f0;
  --card:#fff;
  --text:#000;
  --muted:#555;
}
body.light input,body.light button{background:#ddd;color:#000}
body.light #modeToggle{background:#eee;color:#000}

/* Top controls realignment */
.controls {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 16px;
}
.controls input {
  flex: 1 1 60%;
  min-width: 120px;
}
.controls button {
  flex: 1 1 18%;
  min-width: 80px;
}
</style>
</head>

<body>
<main>

<button id="modeToggle" onclick="toggleMode()">ğŸŒ“</button>

<h1>ğŸŒ¤ Rituva</h1>

<div class="controls">
  <input id="search" placeholder="Search city">
  <button onclick="searchCity()">Search</button>
  <button onclick="useMyLocation()">ğŸ“</button>
</div>

<h2 id="location">Loadingâ€¦</h2>
<div id="temperature" class="big-temp">â€“Â°C</div>

<div class="grid">
  <div class="card center" id="aqiCard">
    <div class="label">AQI (24H)</div>
    <div id="aqiValue" class="value">â€“</div>
    <div id="aqiText" class="sub"></div>
    <div class="note">Estimated Â· Model-based</div>
  </div>
  <div class="card center">
    <div class="label">AQI Trend</div>
    <div id="aqiTrend" class="value">â€“</div>
    <div id="aqiTrendText" class="sub"></div>
  </div>
  <div class="card center">
    <div class="label">ğŸ˜· Mask</div>
    <div id="maskText" class="value">â€“</div>
    <div id="maskNote" class="sub"></div>
  </div>
  <div class="card center">
    <div class="label">Wind</div>
    <div id="wind" class="value">â€“</div>
    <div class="sub">km/h</div>
  </div>
</div>

<h2>ğŸš¨ Rain Alert (Next 3H)</h2>
<div class="card" id="rainCard"><div id="rainAlert" class="alert ok">Checkingâ€¦</div></div>

<h2>ğŸŒ© Thunderstorm Warning</h2>
<div class="card" id="stormCard"><div id="stormAlert" class="alert ok">Checkingâ€¦</div></div>

<h2>ğŸŒ¬ Wind Gust Warning</h2>
<div class="card" id="gustCard"><div id="windAlert" class="alert ok">Checkingâ€¦</div></div>

<h2>ğŸ”¥ Heat Stress Index</h2>
<div class="card center" id="heatCard">
  <div id="heatValue" class="value">â€“</div>
  <div id="heatText" class="sub"></div>
</div>

<h2>â„ï¸ Cold Stress / Wind Chill</h2>
<div class="card center" id="coldCard">
  <div id="coldValue" class="value">â€“</div>
  <div id="coldText" class="sub"></div>
</div>

<h2>ğŸŒŠ Flood Risk (Rain Accumulation)</h2>
<div class="card center" id="floodCard">
  <div id="floodValue" class="value">â€“</div>
  <div id="floodText" class="sub"></div>
</div>

<h2>ğŸŒ¡ Temperature (Next 24H)</h2>
<div class="card">
  <canvas id="temp24"></canvas>
  <div class="sub center">
    Min <span id="tMin"></span>Â° Â· Max <span id="tMax"></span>Â°
  </div>
</div>

<h2>ğŸ“… 7-Day Temperature</h2>
<div class="card" id="week"></div>

<footer>
Â© Manik Roy 2025. All Rights Reserved.
</footer>

</main>

<script>
// Dark/Light Mode Toggle
function toggleMode(){document.body.classList.toggle("light")}

// AQI Calculation
const PM25=[{cL:0,cH:12,iL:0,iH:50},{cL:12.1,cH:35.4,iL:51,iH:100},{cL:35.5,cH:55.4,iL:101,iH:150},{cL:55.5,cH:150.4,iL:151,iH:200},{cL:150.5,cH:250.4,iL:201,iH:300},{cL:250.5,cH:500,iL:301,iH:500}];
const PM10=[{cL:0,cH:54,iL:0,iH:50},{cL:55,cH:154,iL:51,iH:100},{cL:155,cH:254,iL:101,iH:150},{cL:255,cH:354,iL:151,iH:200},{cL:355,cH:424,iL:201,iH:300},{cL:425,cH:604,iL:301,iH:500}];
const avg=a=>a.reduce((x,y)=>x+y,0)/a.length;
const calcAQI=(c,b)=>{const x=b.find(v=>c>=v.cL&&c<=v.cH);return x?Math.round(((x.iH-x.iL)/(x.cH-x.cL))*(c-x.cL)+x.iL):0};
const aqiLabel=a=>a<=50?"Good ğŸ˜Š":a<=100?"Moderate ğŸ™‚":a<=150?"Sensitive ğŸ˜·":a<=200?"Unhealthy âš ï¸":a<=300?"Very Unhealthy ğŸš¨":"Hazardous â˜ ï¸";

// Heat Index
function calcHeatIndex(T,RH){
  RH=Math.min(Math.max(RH,0),100);
  let HI=-8.784695 +1.61139411*T +2.338549*RH -0.14611605*T*RH -0.012308094*T*T -0.016424828*RH*RH +0.002211732*T*T*RH +0.00072546*T*RH*RH -0.000003582*T*T*RH*RH;
  return Math.round(HI);
}

// Wind Chill
function calcWindChill(T,V){
  if(T>10) return "â€”";
  return Math.round(13.12 +0.6215*T -11.37*Math.pow(V,0.16)+0.3965*T*Math.pow(V,0.16));
}

// Draw chart
function drawLine(id,a){
  const c=document.getElementById(id),x=c.getContext("2d");
  x.clearRect(0,0,c.width,c.height);
  const m=Math.min(...a),M=Math.max(...a)||1;
  x.strokeStyle="#4fd1c5";x.lineWidth=2;x.beginPath();
  a.forEach((v,i)=>{const px=i*(c.width/(a.length-1));const py=c.height-((v-m)/(M-m||1))*c.height;i?x.lineTo(px,py):x.moveTo(px,py)});
  x.stroke();
}

// Load weather
async function load(lat,lon,label){
  document.getElementById("location").textContent=label;
  const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,precipitation,precipitation_probability,relativehumidity_2m,windspeed_10m,windgusts_10m&daily=temperature_2m_min,temperature_2m_max&timezone=auto`).then(r=>r.json());

  temperature.textContent=w.current_weather.temperature+"Â°C";
  wind.textContent=w.current_weather.windspeed;

  // Heat Index
  const HI=calcHeatIndex(w.current_weather.temperature,w.hourly.relativehumidity_2m[0]);
  heatValue.textContent=HI+"Â°C";
  heatText.textContent=HI<32?"Comfortable":HI<41?"Caution":HI<54?"Extreme Caution":"Danger";
  const heatCard=document.getElementById("heatCard");
  if(HI<32) heatCard.style.background="#0f2a1f";
  else if(HI<41) heatCard.style.background="#556b2f";
  else if(HI<54) heatCard.style.background="#ff8c00";
  else heatCard.style.background="#b22222";

  // Cold Stress
  const WC=calcWindChill(w.current_weather.temperature,w.current_weather.windspeed);
  coldValue.textContent=WC==="â€”"?"â€”":WC+"Â°C";
  coldText.textContent=WC==="â€”"?"Not applicable":WC>=0?"Cold discomfort":"Frostbite risk";
  const coldCard=document.getElementById("coldCard");
  if(WC==="â€”") coldCard.style.background="#121212";
  else if(WC>=0) coldCard.style.background="#1e3f66";
  else coldCard.style.background="#0f1f40";

  // Rain + Flood
  const rain24=w.hourly.precipitation.slice(0,24);
  const rain48=w.hourly.precipitation.slice(0,48);
  const r24=rain24.reduce((a,b)=>a+b,0);
  const r48=rain48.reduce((a,b)=>a+b,0);
  floodValue.textContent=`${r24.toFixed(1)}mm / ${r48.toFixed(1)}mm`;
  floodText.textContent=r48>120?"Severe flood risk":r48>60?"Urban flooding likely":r48>30?"Waterlogging possible":"Low flood risk";
  const floodCard=document.getElementById("floodCard");
  if(r48>120) floodCard.style.background="#b22222";
  else if(r48>60) floodCard.style.background="#ff8c00";
  else if(r48>30) floodCard.style.background="#e6e600";
  else floodCard.style.background="#0f2a1f";

  // Alerts
  const rain3=w.hourly.precipitation.slice(0,3);
  const gust6=w.hourly.windgusts_10m.slice(0,6);

  // Rain Alert
  rainAlert.textContent=Math.max(...rain3)>=2?"Heavy rain likely":Math.max(...rain3)>=0.5?"Light rain possible":"No rain expected";
  const rainCard=document.getElementById("rainCard");
  if(Math.max(...rain3)>=2) rainCard.style.background="#b22222";
  else if(Math.max(...rain3)>=0.5) rainCard.style.background="#e6e600";
  else rainCard.style.background="#0f2a1f";

  // Wind Gust
  windAlert.textContent=Math.max(...gust6)>=70?"Dangerous gusts":Math.max(...gust6)>=50?"Strong gusts":"No strong gusts";
  const gustCard=document.getElementById("gustCard");
  if(Math.max(...gust6)>=70) gustCard.style.background="#b22222";
  else if(Math.max(...gust6)>=50) gustCard.style.background="#ff8c00";
  else gustCard.style.background="#0f2a1f";

  // Storm Alert
  stormAlert.textContent=(Math.max(...rain3)>=2&&Math.max(...gust6)>=50)?"Thunderstorm likely":"No thunderstorm";
  const stormCard=document.getElementById("stormCard");
  stormCard.style.background=(Math.max(...rain3)>=2&&Math.max(...gust6)>=50)?"#b22222":"#0f2a1f";

  // Temp chart
  const t24=w.hourly.temperature_2m.slice(0,24);
  drawLine("temp24",t24);
  tMin.textContent=Math.min(...t24).toFixed(1);
  tMax.textContent=Math.max(...t24).toFixed(1);

  // Week
  week.innerHTML="";
  w.daily.time.forEach((d,i)=>{
    week.innerHTML+=`<div class="day"><span>${new Date(d).toLocaleDateString(undefined,{weekday:"short"})}</span><span>${w.daily.temperature_2m_min[i]}Â° / ${w.daily.temperature_2m_max[i]}Â°</span></div>`;
  });

  // AQI
  const aq=await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5,pm10&timezone=auto`).then(r=>r.json());
  const pm25=aq.hourly.pm2_5.slice(-24);
  const pm10=aq.hourly.pm10.slice(-24);
  const aqi=Math.max(calcAQI(avg(pm25),PM25),calcAQI(avg(pm10),PM10));
  aqiValue.textContent=aqi;
  aqiText.textContent=aqiLabel(aqi);
  const aqiCard=document.getElementById("aqiCard");
  if(aqi<=50) aqiCard.style.background="#0f2a1f";
  else if(aqi<=100) aqiCard.style.background="#556b2f";
  else if(aqi<=150) aqiCard.style.background="#e6e600";
  else if(aqi<=200) aqiCard.style.background="#ff8c00";
  else if(aqi<=300) aqiCard.style.background="#b22222";
  else aqiCard.style.background="#8b0000";

  // AQI Trend & Mask
  const early=Math.max(calcAQI(avg(pm25.slice(0,6)),PM25),calcAQI(avg(pm10.slice(0,6)),PM10));
  const late=Math.max(calcAQI(avg(pm25.slice(-6)),PM25),calcAQI(avg(pm10.slice(-6)),PM10));
  aqiTrend.textContent=late-early<=-10?"â¬‡ Improving":late-early>=10?"â¬† Worsening":"â– Stable";
  aqiTrendText.textContent="Last 24 hours";
  maskText.textContent=aqi<=50?"No mask":aqi<=100?"Optional":aqi<=150?"Wear mask":aqi<=200?"N95 advised":"Avoid outdoors";
  maskNote.textContent="Based on AQI";
}

// Search
function searchCity(){
  fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${search.value}&count=1`)
  .then(r=>r.json())
  .then(d=>{
    if(d.results){
      const c=d.results[0];
      load(c.latitude,c.longitude,`${c.name}, ${c.country}`);
    }
  });
}

// Geolocation
function useMyLocation(){
  navigator.geolocation.getCurrentPosition(p=>{
    load(p.coords.latitude,p.coords.longitude,"My Location");
  });
}

// Default
load(22.5726,88.3639,"Kolkata, India");
</script>

</body>
</html>
