<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Rituva â€“ Weather & AQI Intelligence</title>
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#000000" />
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
*{box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont}
body{margin:0;min-height:100vh;display:flex;justify-content:center;padding:12px;background:linear-gradient(135deg,#667eea,#764ba2)}
body.dark{background:#121212}
body.oled{background:#000}
.app{width:100%;max-width:420px;padding:16px;border-radius:22px;background:rgba(255,255,255,.18);backdrop-filter:blur(16px)}
body.dark .app,body.oled .app{background:#000}
input,button{width:100%;padding:14px;border-radius:14px;border:none;margin-bottom:12px;font-size:15px}
button{font-weight:600;background:rgba(255,255,255,.35)}
body.dark button,body.oled button{background:#1f1f1f;color:#fff}
.section{margin-bottom:18px}
.details{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.card{background:rgba(255,255,255,.25);border-radius:16px;padding:12px;text-align:center;font-size:13px}
body.dark .card,body.oled .card{background:#111}
.big{font-size:28px;font-weight:700}
#temp{font-size:54px;font-weight:800;text-align:center}
.hourly{display:flex;gap:10px;overflow-x:auto;padding-bottom:10px}
.hour{display:flex;flex-direction:column;align-items:center;font-size:11px}
.bar{width:20px;border-radius:8px 8px 0 0}
.bar.temp{background:#ff7043}
.bar.aqi{background:#43a047}
.bar.rain{background:#42a5f5}
#map{height:260px;border-radius:18px}
</style>
</head>
<body>
<div class="app">
<h1>ğŸŒ¦ Rituva</h1>
<button id="themeBtn">ğŸŒ™ Theme</button>
<div class="section">
<input id="cityInput" placeholder="Search city" />
<button onclick="searchCity()">Search</button>
<button onclick="useLocation()">ğŸ“ Use My Location</button>
</div>
<div class="section">
<h2 id="location">Loadingâ€¦</h2>
<div id="temp">--Â°C</div>
</div>
<div class="section details">
<div class="card"><h4>AQI</h4><div id="aqiValue" class="big">--</div><div id="aqiLabel">--</div></div>
<div class="card"><h4>Wind</h4><div id="wind">--</div></div>
<div class="card"><h4>Rain</h4><div id="rainNow">--</div></div>
<div class="card"><h4>Humidity</h4><div id="humidity">--</div></div>
<div class="card"><h4>Pressure</h4><div id="pressure">--</div></div>
<div class="card"><h4>Elevation</h4><div id="elevation">--</div></div>
<div class="card"><h4>UV Index</h4><div id="uvIndex">--</div></div>
</div>
<div class="section">
<h3>ğŸŒ« AQI Intelligence</h3>
<div class="details" id="aqiInsights">
<div class="card" id="aqiHealth">Health Impact: --</div>
<div class="card" id="aqiAdvice">Advice: --</div>
<div class="card" id="aqiTrend">Trend: --</div>
<div class="card" id="aqiDominant">Dominant: --</div>
<div class="card" id="aqiMask">Mask: --</div>
</div>
</div>
<div class="section">
<h3>â˜” Rain Intelligence</h3>
<div class="details" id="rainIntel">
<div class="card" id="rainStatus">Status: --</div>
<div class="card" id="rainAdvice">Advice: --</div>
<div class="card" id="rainProbability">Probability: --%</div>
<div class="card" id="rainAlert">Alert: --</div>
</div>
</div>
<div class="section">
<h3>ğŸ“ˆ AQI (24H)</h3><div class="hourly" id="aqiGraph"></div>
<h3>ğŸŒ¡ Temperature (24H)</h3><div class="hourly" id="tempGraph"></div>
<h3>ğŸŒ§ Rain (24H)</h3><div class="hourly" id="rainGraph"></div>
</div>
<div class="section">
<h3>ğŸ“… 7-Day Temperature</h3>
<div class="details" id="temp7d"></div>
</div>
<div class="section">
<h3>ğŸ—º Pollution Intelligence Map</h3>
<div id="map"></div>
</div>
<footer style="text-align:center;font-size:11px;margin-top:14px">Â© Manik Roy</footer>
</div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
<script>
const $=id=>document.getElementById(id)
let theme="light";
$("themeBtn").onclick=()=>{theme=theme==="light"?"dark":theme==="dark"?"oled":"light";document.body.className=theme}
function compass(d){return["N","NE","E","SE","S","SW","W","NW"][Math.round(d/45)%8]}
function last24(a){return a?a.slice(-24):[]}
function hourLabel(i){let d=new Date();d.setHours(d.getHours()-23+i);return d.getHours()+":00"}
function renderBars(el,data,max,cls){el.innerHTML="";data.forEach((v,i)=>{let h=Math.max(4,(v/max)*120);el.innerHTML+=`<div class='hour'><div class='bar ${cls}' style='height:${h}px'></div><small>${hourLabel(i)}</small></div>`})}
function render7(max,min){$("temp7d").innerHTML="";max.forEach((v,i)=>$("temp7d").innerHTML+=`<div class='card'>Day ${i+1}<br><b>${v}Â° / ${min[i]}Â°</b></div>`)}
let map,heat;
function drawMap(lat,lon,aqi){if(!map){map=L.map("map").setView([lat,lon],10);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map)}if(heat)map.removeLayer(heat);heat=L.heatLayer([[lat,lon,aqi/300],[lat+0.02,lon+0.02,0.6],[lat-0.02,lon-0.02,0.4]],{radius:45,blur:25,gradient:{0.2:"#00e676",0.5:"#ffeb3b",1:"#f44336"}}).addTo(map)}
async function load(lat,lon,name){
  $("location").textContent=name;
  try{
    const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,precipitation,relative_humidity_2m,pressure_msl,uv_index&daily=temperature_2m_max,temperature_2m_min&timezone=auto`).then(r=>r.json());
    const a=await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5,pm10&timezone=auto`).then(r=>r.json());
    // Current Weather
    $("temp").textContent=w.current_weather.temperature+"Â°C";
    $("wind").textContent=w.current_weather.windspeed+" km/h "+compass(w.current_weather.winddirection);
    $("humidity").textContent=w.hourly.relative_humidity_2m.slice(-1)[0]+"%";
    $("rainNow").textContent=w.hourly.precipitation.slice(-1)[0]+" mm";
    $("pressure").textContent=w.hourly.pressure_msl.slice(-1)[0]+" hPa";
    $("elevation").textContent=Math.round(w.elevation||0)+" m";
    $("uvIndex").textContent=w.hourly.uv_index.slice(-1)[0]||"--";
    // AQI
    const pm25=last24(a.hourly.pm2_5);
    const pm10=last24(a.hourly.pm10);
    const aqi=Math.round((pm25[pm25.length-1]+pm10[pm10.length-1])/2);
    $("aqiValue").textContent=aqi;
    $("aqiLabel").textContent=aqi<=50?"Good":aqi<=100?"Moderate":"Poor";
    $("aqiHealth").textContent=aqi<=50?"Health Impact: Minimal":aqi<=100?"Health Impact: Sensitive groups affected":"Health Impact: Unhealthy";
    $("aqiAdvice").textContent=aqi<=50?"Advice: Enjoy outdoor activities":aqi<=100?"Advice: Limit prolonged exertion":"Advice: Avoid outdoor exposure";
    $("aqiTrend").textContent=(pm25[pm25.length-1]>pm25[0])?"Trend: Rising â†‘":"Trend: Falling â†“";
    $("aqiDominant").textContent=(pm25[pm25.length-1]>pm10[pm10.length-1])?"Dominant: PM2.5":"Dominant: PM10";
    $("aqiMask").textContent=aqi<=100?"Mask: Optional":"Mask: N95";
    // Rain Intelligence
    const rainNowVal=w.hourly.precipitation.slice(-1)[0];
    $("rainStatus").textContent=rainNowVal>0?`Status: Raining (${rainNowVal} mm)`:"Status: No Rain";
    $("rainAdvice").textContent=rainNowVal>5?"Advice: Stay indoors":rainNowVal>0?"Advice: Carry umbrella":"Advice: No precautions needed";
    $("rainProbability").textContent=`Probability: ${Math.max(...w.hourly.precipitation.map(v=>v))}%`;
    $("rainAlert").textContent=rainNowVal>10?"Alert: Heavy Rain":rainNowVal>3?"Alert: Moderate Rain":"Alert: None";
    // Graphs & 7-day
    renderBars($("aqiGraph"),pm25,300,"aqi");
    renderBars($("tempGraph"),last24(w.hourly.temperature_2m),45,"temp");
    renderBars($("rainGraph"),last24(w.hourly.precipitation),10,"rain");
    render7(w.daily.temperature_2m_max,w.daily.temperature_2m_min);
    drawMap(lat,lon,aqi);
  } catch(e){alert("Failed to load data. Please check your connection.")}
}
async function searchCity(){const q=$("cityInput").value;if(!q)return;const g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1`).then(r=>r.json());if(g.results)load(g.results[0].latitude,g.results[0].longitude,g.results[0].name)}
function useLocation(){navigator.geolocation.getCurrentPosition(p=>load(p.coords.latitude,p.coords.longitude,"Current Location"),()=>alert("Location permission denied"))}
load(22.5726,88.3639,"Kolkata, India")
</script>
</body>
</html>
