<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rituva â€“ Smart Weather</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#667eea">

<style>
*{box-sizing:border-box;font-family:system-ui,sans-serif}
body{
  margin:0;min-height:100vh;display:flex;justify-content:center;
  align-items:flex-start;padding:12px;overflow:auto;
  background:linear-gradient(135deg,#667eea,#764ba2);
  color:#000;transition:.3s;
}
body.dark{
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}
.app{
  width:100%;max-width:380px;min-height:100vh;
  padding:16px;border-radius:22px;
  backdrop-filter:blur(18px);
  background:rgba(255,255,255,0.18);
  border:1px solid rgba(255,255,255,.35);
  display:flex;flex-direction:column;
}
body.dark .app{background:rgba(0,0,0,.35)}
input,button{
  width:100%;padding:12px;border-radius:12px;
  border:none;margin-bottom:10px;text-align:center;
}
button{background:rgba(255,255,255,.35);font-weight:bold}
.icon{font-size:48px}
.details{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:15px}
.detail-card{
  background:rgba(255,255,255,.2);
  border-radius:16px;padding:12px;text-align:center
}
body.dark .detail-card{background:rgba(0,0,0,.4)}
.big{font-size:26px;font-weight:bold}
.label{font-size:13px}
.hint{font-size:12px;margin-top:6px}

.hourly,.forecast{
  display:flex;gap:10px;overflow-x:auto;
  margin-top:12px;height:140px;padding:6px
}
.hour,.day{
  min-width:36px;display:flex;
  flex-direction:column;align-items:center;justify-content:flex-end
}
.hour-label,.day-label{font-size:11px}

.day-bar-container{height:80px;width:16px;display:flex;flex-direction:column;justify-content:flex-end}
.day-bar-min{background:rgba(0,150,255,.6)}
.day-bar-max{background:rgba(255,80,50,.7)}

.aqi-good{color:#00e676}
.aqi-moderate{color:#ffeb3b}
.aqi-poor{color:#ff9800}
.aqi-severe{color:#ff5252}

#installBtn{display:none}

.loading-overlay{
  position:absolute;inset:0;
  background:rgba(255,255,255,.25);
  backdrop-filter:blur(10px);
  display:none;align-items:center;justify-content:center;
  border-radius:22px;font-size:18px
}

.footer{
  margin-top:16px;font-size:11px;
  opacity:.8;text-align:center
}
</style>
</head>

<body>
<div class="app">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h1>ğŸŒ¦ Rituva</h1>
    <button id="darkToggle" style="width:42px;height:42px;border-radius:50%">ğŸŒ“</button>
  </div>

  <input id="cityInput" placeholder="Search city">
  <button onclick="searchCity()">Search</button>
  <button id="installBtn">ğŸ“² Install Rituva</button>

  <div class="loading-overlay" id="loading">Loadingâ€¦</div>

  <div class="current" style="text-align:center">
    <h2 id="location">Detecting locationâ€¦</h2>
    <div id="icon" class="icon">â›…</div>
    <p id="temp">--Â°</p>
    <p id="feels">ğŸŒ¡ Feels like: --</p>
    <p id="wind">ğŸŒ¬ -- km/h</p>
    <p id="gust">ğŸ’¨ Gust: -- km/h</p>
    <p id="humidity">ğŸ’§ Humidity: --%</p>
    <p id="pressure">ğŸ“Ÿ Pressure: -- hPa</p>
    <p id="uv">â˜€ UV: --</p>
    <p id="rain">ğŸŒ§ Rain chance: --%</p>
    <p id="updated">â± Updated: --</p>
  </div>

  <div class="details">
    <div class="detail-card">
      <h4>ğŸ§­ Wind Direction</h4>
      <div id="compassValue" class="big">--Â°</div>
      <div id="compassDir" class="label">--</div>
    </div>
    <div class="detail-card" id="aqiCard">
      <h4>ğŸŒ« AQI (PM2.5)</h4>
      <div id="aqiValue" class="big">--</div>
      <div id="aqiLabel" class="label">--</div>
      <div id="aqiAdvice" class="hint">--</div>
    </div>
  </div>

  <h3>ğŸ•’ Next 24 Hours</h3>
  <div class="hourly" id="hourlyTemp"></div>

  <h3>ğŸ“… 7-Day Forecast</h3>
  <div class="forecast" id="forecast"></div>

  <footer class="footer">Â© Manik Roy 2025. All Rights Reserved.</footer>
</div>

<script>
const icons={0:"â˜€",1:"ğŸŒ¤",2:"â›…",3:"â˜",45:"ğŸŒ«",61:"ğŸŒ§",71:"â„",95:"â›ˆ"};
const compassValue=document.getElementById("compassValue");
const compassDir=document.getElementById("compassDir");

function compassDirection(d){
  return["North","NE","East","SE","South","SW","West","NW"][Math.round(d/45)%8]
}
if("DeviceOrientationEvent"in window){
  window.addEventListener("deviceorientation",e=>{
    if(e.alpha!=null){
      const d=Math.round(e.alpha);
      compassValue.textContent=d+"Â°";
      compassDir.textContent=compassDirection(d);
    }
  });
}

function aqiInfo(pm){
  if(pm<=30)return{l:"Good",a:"Safe outdoors",c:"aqi-good"};
  if(pm<=60)return{l:"Moderate",a:"Sensitive reduce exposure",c:"aqi-moderate"};
  if(pm<=90)return{l:"Poor",a:"Avoid long outdoor stay",c:"aqi-poor"};
  return{l:"Severe",a:"Stay indoors",c:"aqi-severe"};
}

function showLoading(s){loading.style.display=s?"flex":"none"}

async function loadWeather(lat,lon,name,country){
  try{
    showLoading(true);
    const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,windgusts_10m,surface_pressure&daily=temperature_2m_min,temperature_2m_max,weathercode&timezone=auto`).then(r=>r.json());
    const a=await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5&timezone=auto`).then(r=>r.json());

    location.textContent=name?(name+", "+country):"Current Location";
    temp.textContent=`ğŸŒ¡ ${w.current_weather.temperature}Â°C`;
    wind.textContent=`ğŸŒ¬ ${w.current_weather.windspeed} km/h`;
    pressure.textContent=`ğŸ“Ÿ ${w.hourly.surface_pressure[0]} hPa`;
    icon.textContent=icons[w.current_weather.weathercode]||"â›…";

    const ai=aqiInfo(a.hourly.pm2_5[0]);
    aqiCard.className="detail-card "+ai.c;
    aqiValue.textContent=a.hourly.pm2_5[0]+" Âµg/mÂ³";
    aqiLabel.textContent=ai.l;
    aqiAdvice.textContent=ai.a;

    hourlyTemp.innerHTML="";
    w.hourly.temperature_2m.slice(0,24).forEach((t,i)=>{
      hourlyTemp.innerHTML+=`<div class="hour"><div style="height:${30+t}px;width:20px;background:#4fc3f7;border-radius:6px"></div><div class="hour-label">${i==0?"Now":(new Date().getHours()+i)%24+":00"}</div></div>`;
    });

    forecast.innerHTML="";
    w.daily.time.forEach((d,i)=>{
      forecast.innerHTML+=`<div class="day"><div class="day-bar-container"><div class="day-bar-max" style="height:${w.daily.temperature_2m_max[i]}px"></div><div class="day-bar-min" style="height:${w.daily.temperature_2m_min[i]}px"></div></div>${icons[w.daily.weathercode[i]]||"â›…"}<div class="day-label">${d.slice(5)}</div></div>`;
    });

  }catch(e){alert("Weather load failed")}
  finally{showLoading(false)}
}

async function searchCity(){
  const q=cityInput.value.trim();
  if(!q)return;
  const g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1`).then(r=>r.json());
  if(!g.results)return alert("City not found");
  const c=g.results[0];
  loadWeather(c.latitude,c.longitude,c.name,c.country);
}

navigator.geolocation.getCurrentPosition(p=>{
  loadWeather(p.coords.latitude,p.coords.longitude,"","");
});

darkToggle.onclick=()=>document.body.classList.toggle("dark");

// PWA
if("serviceWorker"in navigator){
  navigator.serviceWorker.register("sw.js");
}
let deferredPrompt;
window.addEventListener("beforeinstallprompt",e=>{
  e.preventDefault();deferredPrompt=e;
  installBtn.style.display="block";
});
installBtn.onclick=async()=>{
  if(!deferredPrompt)return;
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  installBtn.style.display="none";
};
</script>
</body>
</html>
