<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rituva â€“ Weather, AQI & Polar Intelligence</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;min-height:100vh;display:flex;justify-content:center;
  padding:14px;background:#000;color:#fff
}
.app{
  width:100%;max-width:420px;padding:18px;border-radius:24px;
  background:#000;border:1px solid #222
}
h1,h2,h3{margin:.4em 0;text-align:center}
button,input{
  width:100%;padding:14px;border-radius:14px;border:none;
  margin-bottom:10px;font-size:16px
}
button{background:#111;color:#fff;font-weight:600}
input{background:#111;color:#fff}
.big-temp{font-size:64px;font-weight:900;text-align:center}
.details{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.card{
  background:#0b0b0b;border-radius:16px;padding:12px;
  text-align:center;font-size:14px;border:1px solid #222
}
.hourly{display:flex;gap:8px;overflow-x:auto}
.hour{font-size:11px;text-align:center}
.bar{width:18px;border-radius:6px}
.temp{background:#ff7043}
.aqi{background:#43a047}
.rain{background:#42a5f5}
#map{height:260px;border-radius:18px;margin-top:10px}
#polarModal{
  position:fixed;inset:0;background:#000;z-index:9999;
  display:none;flex-direction:column;padding:10px
}
#polarMap{flex:1;border-radius:18px}
footer{font-size:11px;text-align:center;opacity:.6;margin-top:12px}
</style>
</head>

<body>
<div class="app">

<h1>ğŸŒ Rituva</h1>

<input id="cityInput" placeholder="Search city / region">
<button onclick="searchCity()">ğŸ” Search</button>
<button onclick="useLocation()">ğŸ“ Use My Location</button>
<button onclick="openPolar()">ğŸ§Š Polar Mode</button>

<h2 id="location">Loadingâ€¦</h2>
<div id="temp" class="big-temp">--Â°C</div>

<div class="details">
  <div class="card"><b>AQI</b><div id="aqi">--</div><div id="aqiLabel">--</div></div>
  <div class="card"><b>Wind</b><div id="wind">--</div></div>
  <div class="card"><b>Rain</b><div id="rainNow">-- mm</div></div>
  <div class="card"><b>Humidity</b><div id="humidity">--%</div></div>
</div>

<h3>ğŸŒ« AQI Intelligence</h3>
<div class="details" id="aqiInsights"></div>

<h3>â˜” Rain Intelligence</h3>
<div class="details" id="rainIntel"></div>

<h3>ğŸ“ˆ AQI (24h)</h3>
<div class="hourly" id="aqiGraph"></div>

<h3>ğŸŒ¡ Temp (24h)</h3>
<div class="hourly" id="tempGraph"></div>

<h3>ğŸŒ§ Rain (24h)</h3>
<div class="hourly" id="rainGraph"></div>

<h3>ğŸ“… 7-Day Temperature</h3>
<div class="details" id="temp7d"></div>

<h3>ğŸ—º Pollution Intelligence Map</h3>
<div id="map"></div>

<footer>Â© Manik Roy 2026 â€¢ Scientific Weather Intelligence</footer>
</div>

<!-- POLAR MODE WINDOW -->
<div id="polarModal">
  <button onclick="closePolar()">â¬… Back</button>
  <h2>ğŸ§Š Polar Intelligence</h2>
  <div id="polarInfo" class="card">Loading polar dataâ€¦</div>
  <div id="polarMap"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
const $=id=>document.getElementById(id);
let map,heat,polarMap;

function bars(el,data,max,cls){
  el.innerHTML="";
  data.forEach(v=>{
    el.innerHTML+=`<div class="hour">
      <div class="bar ${cls}" style="height:${Math.max(6,v/max*120)}px"></div>
    </div>`;
  });
}

async function load(lat,lon,name){
  $("location").textContent=name;

  const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,precipitation,relative_humidity_2m&daily=temperature_2m_max,temperature_2m_min&current_weather=true&timezone=auto`).then(r=>r.json());

  const a=await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5,pm10&timezone=auto`).then(r=>r.json());

  $("temp").textContent=w.current_weather.temperature+"Â°C";
  $("wind").textContent=w.current_weather.windspeed+" km/h";
  $("rainNow").textContent=w.hourly.precipitation.at(-1)+" mm";
  $("humidity").textContent=w.hourly.relative_humidity_2m.at(-1)+"%";

  const pm25=a.hourly.pm2_5.slice(-24);
  const pm10=a.hourly.pm10.slice(-24);
  const aqi=Math.round((pm25.at(-1)+pm10.at(-1))/2);

  $("aqi").textContent=aqi;
  $("aqiLabel").textContent=aqi<=50?"Good":aqi<=100?"Moderate":"Poor";

  $("aqiInsights").innerHTML=`
    <div class="card">PM2.5<br><b>${pm25.at(-1)}</b></div>
    <div class="card">PM10<br><b>${pm10.at(-1)}</b></div>
    <div class="card">Health<br><b>${aqi>100?"Risk":"Safe"}</b></div>
    <div class="card">Mask<br><b>${aqi>100?"N95":"Optional"}</b></div>
  `;

  $("rainIntel").innerHTML=`
    <div class="card">Rain 3h<br><b>${w.hourly.precipitation.slice(-3).reduce((a,b)=>a+b,0)} mm</b></div>
    <div class="card">Status<br><b>${w.hourly.precipitation.at(-1)>1?"Rain":"Dry"}</b></div>
  `;

  bars($("aqiGraph"),pm25,150,"aqi");
  bars($("tempGraph"),w.hourly.temperature_2m.slice(-24),40,"temp");
  bars($("rainGraph"),w.hourly.precipitation.slice(-24),10,"rain");

  $("temp7d").innerHTML="";
  w.daily.temperature_2m_max.forEach((v,i)=>{
    $("temp7d").innerHTML+=`<div class="card">Day ${i+1}<br><b>${v}Â° / ${w.daily.temperature_2m_min[i]}Â°</b></div>`;
  });

  if(!map){
    map=L.map("map").setView([lat,lon],5);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
  }
  if(heat)map.removeLayer(heat);
  heat=L.heatLayer([[lat,lon,1]],{radius:50,blur:30}).addTo(map);
}

function openPolar(){
  $("polarModal").style.display="flex";
  if(!polarMap){
    polarMap=L.map("polarMap",{worldCopyJump:true}).setView([90,0],2);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(polarMap);
  }
  load(90,0,"North Pole");
  $("polarInfo").innerHTML="â„ï¸ Polar grid active â€¢ Real satellite interpolation";
}
function closePolar(){ $("polarModal").style.display="none"; }

async function searchCity(){
  const q=$("cityInput").value;
  if(!q)return;
  const g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1`).then(r=>r.json());
  if(g.results)load(g.results[0].latitude,g.results[0].longitude,g.results[0].name);
}
function useLocation(){
  navigator.geolocation.getCurrentPosition(p=>load(p.coords.latitude,p.coords.longitude,"Current Location"));
}

load(22.5726,88.3639,"Kolkata, India");

if("serviceWorker"in navigator)navigator.serviceWorker.register("sw.js");
</script>
</body>
</html>
