<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Rituva</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000">

<style>
:root{
--bg:#000;
--card:#1a1a1a;
--soft:#222;
--text:#fff;
--muted:#9a9a9a;
--radius:26px
}
.light{
--bg:#f5f5f5;
--card:#fff;
--soft:#e6e6e6;
--text:#000;
--muted:#555
}
.oled{
--bg:#000;
--card:#000;
--soft:#000;
--text:#fff;
--muted:#777
}

*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui}
.app{max-width:430px;margin:auto;padding:18px}
h1{text-align:center;font-size:34px;margin-bottom:6px}
.section-title{font-size:24px;margin:26px 0 14px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.card{background:var(--card);padding:20px;border-radius:var(--radius);text-align:center}
.card small{color:var(--muted)}
.card b{font-size:28px;display:block;margin-top:6px}
.full{grid-column:1/-1}
.hero{text-align:center;margin-top:10px}
.hero-temp{font-size:88px;font-weight:800}
input,button{width:100%;padding:16px;border-radius:20px;border:none;background:var(--soft);color:var(--text);font-size:17px;margin-bottom:10px}
footer{text-align:center;color:var(--muted);font-size:13px;margin-top:30px}
</style>
</head>

<body>
<div class="app">

<h1>ğŸŒ¦ Rituva</h1>

<button onclick="toggleTheme()">ğŸŒ“ Dark / Light</button>
<button onclick="toggleOLED()">ğŸ–¤ OLED True Black</button>

<input id="search" placeholder="Search city" onkeydown="if(event.key==='Enter')searchCity()">
<button onclick="searchCity()">Search</button>
<button onclick="useMyLocation()">ğŸ“ Use My Location</button>

<div class="hero">
<small id="city">Loadingâ€¦</small>
<div class="hero-temp" id="temp">--Â°</div>
</div>

<div class="section-title">ğŸŒ¡ Temperature</div>
<div class="grid">
<div class="card"><small>Today Min</small><b id="tmin">--</b></div>
<div class="card"><small>Today Max</small><b id="tmax">--</b></div>
<div class="card"><small>24h Min</small><b id="hmin">--</b></div>
<div class="card"><small>24h Max</small><b id="hmax">--</b></div>
</div>

<div class="section-title">ğŸŒ§ Rain & Monsoon</div>
<div class="grid">
<div class="card"><small>Rain (24h)</small><b id="rain">-- mm</b></div>
<div class="card"><small>Monsoon Index</small><b id="monsoon">--</b></div>
<div class="card"><small>Flood Risk</small><b id="flood">--</b></div>
<div class="card"><small>Cyclone Alert</small><b id="cyclone">--</b></div>
</div>

<div class="section-title">ğŸŒ¬ Air Quality</div>
<div class="grid">
<div class="card full"><small>PM2.5</small><b id="pm">--</b></div>
<div class="card"><small>Children</small><b id="aqiC">--</b></div>
<div class="card"><small>Elderly</small><b id="aqiE">--</b></div>
<div class="card"><small>Asthma</small><b id="aqiA">--</b></div>
</div>

<div class="section-title">ğŸ§  Human Impact</div>
<div class="grid">
<div class="card"><small>Heatwave</small><b id="heat">--</b></div>
<div class="card"><small>Night Discomfort</small><b id="night">--</b></div>
<div class="card"><small>Mood</small><b id="mood">--</b></div>
<div class="card"><small>Productivity</small><b id="prod">--</b></div>
<div class="card full"><small>Best Outdoor Time</small><b id="outdoor">--</b></div>
</div>

<div class="section-title">â˜€ï¸ Solar</div>
<div class="grid">
<div class="card"><small>UV Index</small><b id="uv">--</b></div>
<div class="card"><small>Sunburn</small><b id="sunburn">--</b></div>
<div class="card"><small>Wet Bulb</small><b id="wet">--</b></div>
<div class="card"><small>Cold Risk</small><b id="cold">--</b></div>
</div>

<footer>Â© Manik Roy Â· Indicative insights</footer>

</div>

<script>
const $=id=>document.getElementById(id)

function toggleTheme(){
document.body.classList.toggle("light")
localStorage.setItem("theme",document.body.classList.contains("light")?"light":"dark")
}
function toggleOLED(){
document.body.classList.toggle("oled")
localStorage.setItem("oled",document.body.classList.contains("oled")?"on":"off")
}
if(localStorage.getItem("theme")==="light")document.body.classList.add("light")
if(localStorage.getItem("oled")==="on")document.body.classList.add("oled")

async function load(lat,lon,name){
$("city").innerText=name

const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,relative_humidity_2m,precipitation&daily=temperature_2m_min,temperature_2m_max&current_weather=true&timezone=auto`).then(r=>r.json())
const a=await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5`).then(r=>r.json())

const t=w.current_weather.temperature
const h=w.hourly.relative_humidity_2m[0]
const rain=w.hourly.precipitation.slice(0,24).reduce((a,b)=>a+b,0)
const pm=a.hourly.pm2_5[0]

$("temp").innerText=t+"Â°"
$("tmin").innerText=w.daily.temperature_2m_min[0]+"Â°"
$("tmax").innerText=w.daily.temperature_2m_max[0]+"Â°"
$("hmin").innerText=Math.min(...w.hourly.temperature_2m.slice(0,24))+"Â°"
$("hmax").innerText=Math.max(...w.hourly.temperature_2m.slice(0,24))+"Â°"

$("rain").innerText=rain.toFixed(1)
$("monsoon").innerText=rain>50?"Severe":rain>20?"Active":"Weak"
$("flood").innerText=rain>100?"High":rain>50?"Moderate":"Low"
$("cyclone").innerText="None"

$("pm").innerText=Math.round(pm)
$("aqiC").innerText=pm>75?"High":"Low"
$("aqiE").innerText=pm>100?"High":"Moderate"
$("aqiA").innerText=pm>60?"High":"Low"

$("heat").innerText=t>=40?"Extreme":t>=35?"High":"Normal"
$("night").innerText=(t>=28&&h>=70)?"High":"Low"
$("mood").innerText=(t<=32&&h<=70)?"Positive":"Irritable"
$("prod").innerText=(t>=22&&t<=30)?"High":"Low"
$("outdoor").innerText=(t<=30&&rain<5)?"Morning / Evening":"Avoid Noon"

const uv=Math.min(11,Math.round((t-20)/2))
$("uv").innerText=uv
$("sunburn").innerText=uv>=8?"Severe":uv>=5?"High":"Low"

const wet=t*Math.atan(0.1519*Math.sqrt(h+8))-4.6
$("wet").innerText=wet.toFixed(1)+"Â°C"
$("cold").innerText=t<=10?"High":"Low"
}

function useMyLocation(){
navigator.geolocation.getCurrentPosition(
p=>load(p.coords.latitude,p.coords.longitude,"My Location"),
()=>load(22.57,88.36,"Kolkata")
)}
async function searchCity(){
const q=$("search").value
if(!q)return
const g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=1`).then(r=>r.json())
if(g.results)load(g.results[0].latitude,g.results[0].longitude,g.results[0].name)
}

useMyLocation()

if('serviceWorker' in navigator){
const sw=`self.addEventListener('fetch',e=>e.respondWith(caches.open('rituva').then(c=>c.match(e.request)||fetch(e.request).then(r=>{c.put(e.request,r.clone());return r}))))`
navigator.serviceWorker.register(URL.createObjectURL(new Blob([sw])))
}
</script>
</body>
</html>
